//>>built
require({cache:{"esri/dijit/Geocoder":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/event dojo/dom-attr dojo/dom-class dojo/dom-style dojo/dom-construct dojo/keys dojo/on dojo/query dojo/i18n!../nls/jsapi dojo/text!./templates/Geocoder.html dojo/uacss dijit/a11yclick dijit/_TemplatedMixin dijit/focus ../kernel ../SpatialReference ../graphic ../symbols/PictureMarkerSymbol ./_EventedWidget ../geometry/Point ../geometry/Extent ../tasks/locator ../tasks/query ../tasks/QueryTask ../geometry/scaleUtils".split(" "),
function(t,s,h,u,m,g,k,p,w,f,n,d,x,E,F,r,C,c,l,q,v,z,G,A,B,D,y,H,I){return s("esri.dijit.Geocoder",[G,C],{templateString:E,reHostedFS:/https?:\/\/services.*\.arcgis\.com/i,_eventMap:{select:["result"],"find-results":["results"],"auto-complete":["results"],"geocoder-select":["geocoder"],clear:!0,"enter-key-select":!0,load:!0},constructor:function(a,b){this._css={GeocoderContainerClass:"esriGeocoderContainer",GeocoderClass:"esriGeocoder",GeocoderMultipleClass:"esriGeocoderMultiple",GeocoderIconClass:"esriGeocoderIcon",
GeocoderActiveClass:"esriGeocoderActive",GeocoderResultsOpenClass:"esriGeocoderResultsOpen",GeocoderMenuOpenClass:"esriGeocoderMenuOpen",loadingClass:"esriGeocoderLoading",resultsContainerClass:"esriGeocoderResults",resultsItemClass:"esriGeocoderResult",resultsItemEvenClass:"esriGeocoderResultEven",resultsItemOddClass:"esriGeocoderResultOdd",resultsItemFirstClass:"esriGeocoderResultFirst",resultsItemLastClass:"esriGeocoderResultLast",resultsPartialMatchClass:"esriGeocoderResultPartial",searchButtonClass:"esriGeocoderSearch",
clearButtonClass:"esriGeocoderReset",hasValueClass:"esriGeocoderHasValue",geocoderMenuClass:"esriGeocoderMenu",geocoderMenuHeaderClass:"esriGeocoderMenuHeader",geocoderMenuCloseClass:"esriGeocoderMenuClose",activeMenuClass:"esriGeocoderMenuActive",geocoderMenuArrowClass:"esriGeocoderMenuArrow",geocoderSelectedClass:"esriGeocoderSelected",geocoderSelectedCheckClass:"esriGeocoderSelectedCheck",GeocoderClearClass:"esriGeocoderClearFloat"};this.options={autoComplete:!1,arcgisGeocoder:!0,value:"",theme:"simpleGeocoder",
activeGeocoderIndex:0,maxLocations:6,minCharacters:3,searchDelay:300,geocoderMenu:!0,autoNavigate:!0,showResults:!0,map:null,activeGeocoder:null,geocoders:null,zoomScale:1E4,highlightLocation:!1,symbol:new z(t.toUrl(".")+"/images/sdk_gps_location.png",28,28),graphicsLayer:null};var e=h.mixin({},this.options,a);this.set("autoComplete",e.autoComplete);this.set("arcgisGeocoder",e.arcgisGeocoder);this.set("value",e.value);this.set("theme",e.theme);this.set("activeGeocoderIndex",e.activeGeocoderIndex);
this.set("maxLocations",e.maxLocations);this.set("minCharacters",e.minCharacters);this.set("searchDelay",e.searchDelay);this.set("geocoderMenu",e.geocoderMenu);this.set("autoNavigate",e.autoNavigate);this.set("showResults",e.showResults);this.set("map",e.map);this.set("activeGeocoder",e.activeGeocoder);this.set("geocoders",e.geocoders);this.set("zoomScale",e.zoomScale);this.set("highlightLocation",e.highlightLocation);this.set("symbol",e.symbol);this.set("graphicsLayer",e.graphicsLayer);this.set("results",
[]);this._i18n=x;this._deferreds=[];this._defaultSR=new q(4326);this.watch("value",this._updateValue);this.watch("theme",this._updateTheme);this.watch("activeGeocoder",this._setActiveGeocoder);this.watch("activeGeocoderIndex",this._setActiveGeocoderIndex);this.watch("geocoders",this._updateGeocoder);this.watch("arcgisGeocoder",this._updateGeocoder);this.watch("geocoderMenu",this._updateGeocoder);this.watch("map",this._setupEvents);this.domNode=b},startup:function(){if(this._geocoders.length)if(this.domNode)if(this.get("map"))if(this.get("map").loaded)this._init();
else n.once(this.get("map"),"load",h.hitch(this,function(){this._init()}));else this._init();else console.log("Geocoder:: domNode is undefined."),this.destroy();else console.log("Geocoder:: No geocoders defined."),this.destroy()},postCreate:function(){this.inherited(arguments);this.own(n(this.submitNode,r,h.hitch(this,this._findThenSelect)));this.own(n(this.geocoderMenuArrowNode,r,h.hitch(this,this._toggleGeolocatorMenu)));this.own(n(this.inputNode,r,h.hitch(this,this._inputClick)));this.own(n(this.clearNode,
r,h.hitch(this,this.clear)));this.own(n(this.geocoderMenuCloseNode,r,h.hitch(this,this._hideGeolocatorMenu)));this._updateGeocoder();this._setupEvents();this.get("value")&&this._checkStatus();this._hideMenus()},destroy:function(){this._removeEvents();w.empty(this.domNode);this.inherited(arguments)},clear:function(){this.onClear();var a=this.get("highlightGraphic"),b=this.get("graphicsLayer");a&&(b?b.remove(a):this.get("map").graphics.remove(a),this.set("highlightGraphic",null));g.set(this.inputNode,
"value","");this.set("value","");this.set("results",[]);k.remove(this.containerNode,this._css.hasValueClass);g.set(this.clearNode,"title","");this._hideMenus();this._hideLoading()},show:function(){p.set(this.domNode,"display","block")},hide:function(){p.set(this.domNode,"display","none")},find:function(a){var b=new u;if(a)if("string"===typeof a)this._findQuery(a).then(function(a){b.resolve(a)});else if("object"===typeof a&&a.hasOwnProperty("geometry")){var e;switch(a.geometry.type){case "extent":e=
a.geometry.getCenter();break;case "multipoint":e=a.geometry.getExtent().getCenter();break;case "point":e=a.geometry;break;case "polygon":e=a.geometry.getExtent().getCenter();break;case "polyline":e=a.geometry.getExtent().getCenter()}e&&this._reverseGeocodePoint(e,a.geometry).then(function(e){e.results[0]&&(a.hasOwnProperty("attributes")&&e.results[0].feature.setAttributes(h.mixin(e.results[0].feature.attributes,a.attributes)),a.hasOwnProperty("infoTemplate")&&e.results[0].feature.setInfoTemplate(a.infoTemplate),
a.hasOwnProperty("symbol")&&e.results[0].feature.setSymbol(a.symbol));b.resolve(e)},function(a){b.reject(a)})}else"object"===typeof a&&"point"===a.type?this._reverseGeocodePoint(a).then(function(a){b.resolve(a)},function(a){b.reject(a)}):a instanceof Array&&2===a.length?(e=new A(a,new q({wkid:4326})),this._reverseGeocodePoint(e).then(function(a){b.resolve(a)},function(a){b.reject(a)})):b.reject("Geocoder:: Invalid find type");else this._findQuery(this.get("value")).then(function(a){b.resolve(a)});
return b.promise},focus:function(){c.focus(this.inputNode)},blur:function(){c.curNode&&c.curNode.blur();this.inputNode.blur();this._hideMenus();var a=this.get("map");a&&a.enableKeyboardNavigation()},select:function(a){this.onSelect(a);this._hideMenus();this._hideLoading();this.get("autoNavigate")&&(a&&a.hasOwnProperty("extent")&&this.get("map"))&&this.get("map").setExtent(a.extent);if(a.feature){var b=this.get("highlightGraphic"),e=this.get("graphicsLayer"),c=this.get("symbol")||a.feature.symbol;
b?(b.setGeometry(a.feature.geometry),b.setAttributes(a.feature.attributes),b.setInfoTemplate(a.feature.infoTemplate),b.setSymbol(c)):(b=a.feature,this.get("highlightLocation")&&(b.setSymbol(c),e?e.add(b):this.get("map").graphics.add(b)));this.set("highlightGraphic",b)}},onSelect:function(){},onFindResults:function(){},onAutoComplete:function(){},onGeocoderSelect:function(){},onClear:function(){},onEnterKeySelect:function(){},onLoad:function(){},_autoComplete:function(){var a=this.get("activeGeocoder"),
b=this.reHostedFS.test(a.url);("query"!==a.type||b)&&this._query({delay:this.get("searchDelay"),autoComplete:!0,search:this.get("value")}).then(h.hitch(this,function(a){this.onAutoComplete(a);this.get("showResults")&&this._showResults(a)}))},_init:function(){this.set("loaded",!0);this.onLoad()},_containsNonLatinCharacter:function(a){for(var b=0;b<a.length;b++)if(255<a.charCodeAt(b))return!0;return!1},_findQuery:function(a){var b=new u;this._query({delay:0,search:a}).then(h.hitch(this,function(a){this.onFindResults(a);
b.resolve(a)}),h.hitch(this,function(a){this.onFindResults(a);b.reject(a)}));return b.promise},_reverseGeocodePoint:function(a,b){var e=new u;if(a&&this.get("activeGeocoder")){var c=b||a,d=this.get("activeGeocoder").distance||1500;this._task.outSpatialReference=this._defaultSR;this.get("map")&&(this._task.outSpatialReference=this.get("map").spatialReference);this._task.locationToAddress(a,d,h.hitch(this,function(a){a={results:[this._hydrateResult(a)],geometry:c};this.onFindResults(a);e.resolve(a)}),
h.hitch(this,function(a){e.reject(a)}))}else e.reject("Geocoder:: no point or active geocoder defined");return e.promise},_setEsriGeocoder:function(){this.get("arcgisGeocoder")?("object"===typeof this.get("arcgisGeocoder")?this._arcgisGeocoder=this.get("arcgisGeocoder"):this._arcgisGeocoder={},this._arcgisGeocoder.hasOwnProperty("suggest")||(this._arcgisGeocoder.suggest=!0),this._arcgisGeocoder.hasOwnProperty("singleLineFieldName")||(this._arcgisGeocoder.singleLineFieldName="SingleLine"),this._arcgisGeocoder.url||
(this._arcgisGeocoder.url=("file:"===location.protocol?"http:":location.protocol)+"//geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer"),this._arcgisGeocoder.name||(this._arcgisGeocoder.name=x.widgets.Geocoder.esriGeocoderName),this._arcgisGeocoder.hasOwnProperty("localSearchOptions")||(this._arcgisGeocoder.localSearchOptions={minScale:3E5,distance:5E4}),this.set("arcgisGeocoder",this._arcgisGeocoder)):this.set("arcgisGeocoder",!1)},_setActiveGeocoder:function(){this.set("activeGeocoder",
this._geocoders[this.get("activeGeocoderIndex")]);this._task="query"===this.activeGeocoder.type?new H(this.get("activeGeocoder").url):new D(this.get("activeGeocoder").url);this._updatePlaceholder()},_setGeocoderList:function(){var a=[];this.get("arcgisGeocoder")&&(a=a.concat([this._arcgisGeocoder]));this.get("geocoders")&&this.get("geocoders").length&&(a=a.concat(this.get("geocoders")));this._geocoders=a},_updateGeocoder:function(){this.set("activeGeocoderIndex",0);this._setEsriGeocoder();this._setGeocoderList();
this._setActiveGeocoder();this._insertGeocoderMenuItems()},_updatePlaceholder:function(){this._placeholder="";this.get("activeGeocoder")&&this.get("activeGeocoder").placeholder&&(this._placeholder=this.get("activeGeocoder").placeholder);g.set(this.inputNode,"placeholder",this._placeholder);g.set(this.submitNode,"title",this._placeholder)},_updateValue:function(a,b,e){this._ignoreUpdateValue||(g.set(this.inputNode,"value",e),this._checkStatus())},_updateTheme:function(a,b,e){k.remove(this.domNode,
b);k.add(this.domNode,e)},_setActiveGeocoderIndex:function(a,b,e){this.set("activeGeocoderIndex",e);this._setActiveGeocoder();this._hideMenus();this._insertGeocoderMenuItems();a={attr:this.get("activeGeocoder"),oldVal:b,newVal:e};this.onGeocoderSelect(a)},_clearQueryTimeout:function(){this._queryTimer&&clearTimeout(this._queryTimer)},_query:function(a){a||(a={delay:0});a.search||(a.search=this.get("value"));var b=new u;this._deferreds.push(b);a.delay?(this._clearQueryTimeout(),this._queryTimer=setTimeout(h.hitch(this,
function(){this._performTask(b,a)}),a.delay)):this._performTask(b,a);return b.promise},_performTask:function(a,b){if(b.search){this._hideGeolocatorMenu();this._showLoading();var e="";this.get("activeGeocoder").prefix&&(e+=this.get("activeGeocoder").prefix);e+=b.search;this.get("activeGeocoder").suffix&&(e+=this.get("activeGeocoder").suffix);var c=this.get("activeGeocoder").outFields;c&&(c instanceof Array||(c=[c]));var d=this.get("maxLocations")||6,q=this.get("activeGeocoder").searchExtent,l=this._defaultSR;
this.get("map")&&(l=this.get("map").spatialReference);if("query"===this.get("activeGeocoder").type){var f=new y;f.outSpatialReference=l;f.returnGeometry=!0;f.num=d;q&&(f.geometry=q);d=this.get("activeGeocoder").exactMatch;q=this.get("activeGeocoder").field;l="";this.reHostedFS.test(this.get("activeGeocoder").url)&&this._containsNonLatinCharacter(e)&&(l="N");f.where=d?q+" \x3d "+l+"'"+e+"'":"UPPER("+q+") LIKE "+l+"'%"+e.toUpperCase()+"%'";c&&(f.outFields=c);this._task.execute(f,h.hitch(this,function(e){this._receivedResults(e.features,
a,b)}),h.hitch(this,function(e){this._receivedResults([],a,b)}))}else{f={};this.get("activeGeocoder").categories&&(f.categories=this.get("activeGeocoder").categories);this._task.outSpatialReference=l;if(this.get("map")&&(this.get("activeGeocoder").localSearchOptions&&this.get("activeGeocoder").localSearchOptions.hasOwnProperty("distance")&&this.get("activeGeocoder").localSearchOptions.hasOwnProperty("minScale"))&&(l=this.get("map").getScale(),!this.get("activeGeocoder").localSearchOptions.minScale||
l&&l<=parseFloat(this.get("activeGeocoder").localSearchOptions.minScale)))f.location=this.get("map").extent.getCenter(),f.distance=this.get("activeGeocoder").localSearchOptions.distance;this.get("activeGeocoder").suggest&&b.autoComplete?(f.text=e,this._task.suggestLocations(f).then(h.hitch(this,function(e){this._receivedResults(e,a,b)}),h.hitch(this,function(e){this._receivedResults(e,a,b)}))):(f.address={},f.maxLocations=d,q&&(f.searchExtent=q),this.get("activeGeocoder").sourceCountry&&(f.countryCode=
this.get("activeGeocoder").sourceCountry),b.magicKey&&(f.magicKey=b.magicKey),this.get("activeGeocoder").singleLineFieldName?f.address[this.get("activeGeocoder").singleLineFieldName]=e:f.address["Single Line Input"]=e,c&&(f.outFields=c),this._task.addressToLocations(f,h.hitch(this,function(e){this._receivedResults(e,a,b)}),h.hitch(this,function(e){this._receivedResults(e,a,b)})))}}else this._hideLoading(),a.reject("Geocoder:: no search to perform");(e=this.get("map"))&&e.enableKeyboardNavigation()},
_showResults:function(){this._hideGeolocatorMenu();var a="";if(this.get("results")&&this.get("results").length&&this.resultsNode){for(var b=this.get("value"),e=RegExp("("+b+")","gi"),a=a+'\x3cul role\x3d"presentation"\x3e',b=0;b<this.get("results").length&&5>b;++b){var c=this.get("results")[b].text||this.get("results")[b].name,d=this._css.resultsItemClass+" ",d=0===b%2?d+this._css.resultsItemOddClass:d+this._css.resultsItemEvenClass;0===b?d+=" "+this._css.resultsItemFirstClass:b===this.get("results").length-
1&&(d+=" "+this._css.resultsItemLastClass);a+='\x3cli title\x3d"'+c+'" data-text\x3d"'+c+'" data-item\x3d"true" data-index\x3d"'+b+'" role\x3d"menuitem" tabindex\x3d"0" class\x3d"'+d+'"\x3e'+c.replace(e,'\x3cstrong class\x3d"'+this._css.resultsPartialMatchClass+'"\x3e$1\x3c/strong\x3e')+"\x3c/li\x3e"}a+="\x3c/ul\x3e";this.resultsNode&&(this.resultsNode.innerHTML=a);this._autoCompleteEvent();this._showResultsMenu()}else this.resultsNode&&(this.resultsNode.innerHTML=a),this._hideResultsMenu()},_receivedResults:function(a,
b){this._hideLoading();var e=this._hydrateResults(a);this.set("results",e);e={results:e,value:this.get("value")};b.resolve(e)},_showLoading:function(){k.add(this.containerNode,this._css.loadingClass)},_hideLoading:function(){k.remove(this.containerNode,this._css.loadingClass)},_showGeolocatorMenu:function(){k.add(this.containerNode,this._css.activeMenuClass);k.add(this.domNode,this._css.GeocoderMenuOpenClass);p.set(this.geocoderMenuNode,"display","block");g.set(this.geocoderMenuInsertNode,"aria-hidden",
"false");g.set(this.geocoderMenuArrowNode,"aria-expanded","true")},_hideGeolocatorMenu:function(){k.remove(this.containerNode,this._css.activeMenuClass);k.remove(this.domNode,this._css.GeocoderMenuOpenClass);p.set(this.geocoderMenuNode,"display","none");g.set(this.geocoderMenuInsertNode,"aria-hidden","true");g.set(this.geocoderMenuArrowNode,"aria-expanded","false")},_toggleGeolocatorMenu:function(){this._hideResultsMenu();"block"===p.get(this.geocoderMenuNode,"display")?this._hideGeolocatorMenu():
this._showGeolocatorMenu()},_showResultsMenu:function(){k.add(this.containerNode,this._css.GeocoderActiveClass);k.add(this.domNode,this._css.GeocoderResultsOpenClass);p.set(this.resultsNode,"display","block");g.set(this.resultsNode,"aria-hidden","false")},_hideResultsMenu:function(){p.set(this.resultsNode,"display","none");k.remove(this.containerNode,this._css.GeocoderActiveClass);k.remove(this.domNode,this._css.GeocoderResultsOpenClass);g.set(this.resultsNode,"aria-hidden","true")},_hideMenus:function(){this._hideGeolocatorMenu();
this._hideResultsMenu()},_insertGeocoderMenuItems:function(){if(this.get("geocoderMenu")&&this._geocoders&&1<this._geocoders.length){var a,b="",e;a='\x3cul role\x3d"presentation"\x3e';for(e=0;e<this._geocoders.length;e++){b=this._css.resultsItemClass+" ";b=0===e%2?b+this._css.resultsItemOddClass:b+this._css.resultsItemEvenClass;e===this.get("activeGeocoderIndex")&&(b+=" "+this._css.geocoderSelectedClass);0===e?b+=" "+this._css.resultsItemFirstClass:e===this._geocoders.length-1&&(b+=" "+this._css.resultsItemLastClass);
var c=this._geocoders[e].name||x.widgets.Geocoder.main.untitledGeocoder;a+='\x3cli data-index\x3d"'+e+'" data-item\x3d"true" role\x3d"menuitem" tabindex\x3d"0" class\x3d"'+b+'"\x3e';a+='\x3cdiv class\x3d"'+this._css.geocoderSelectedCheckClass+'"\x3e\x3c/div\x3e';a+=c;a+='\x3cdiv class\x3d"'+this._css.GeocoderClearClass+'"\x3e\x3c/div\x3e';a+="\x3c/li\x3e"}this.geocoderMenuInsertNode.innerHTML=a+"\x3c/ul\x3e";this._geocoderMenuEvent();p.set(this.geocoderMenuNode,"display","none");p.set(this.geocoderMenuArrowNode,
"display","block");k.add(this.containerNode,this._css.GeocoderMultipleClass)}else this.geocoderMenuInsertNode.innerHTML="",p.set(this.geocoderMenuNode,"display","none"),p.set(this.geocoderMenuArrowNode,"display","none"),k.remove(this.containerNode,this._css.GeocoderMultipleClass)},_checkStatus:function(){this.get("value")?(k.add(this.containerNode,this._css.hasValueClass),g.set(this.clearNode,"title",x.widgets.Geocoder.main.clearButtonTitle)):this.clear()},_autoCompleteEvent:function(){var a=d('[data-item\x3d"true"]',
this.resultsNode);this._acEvent&&this._acEvent.remove();this._acEvent=n(a,"click, keydown",h.hitch(this,function(b){this._clearQueryTimeout();var e=parseInt(g.get(b.currentTarget,"data-index"),10),c=g.get(b.currentTarget,"data-text");"click"===b.type||"keydown"===b.type&&b.keyCode===f.ENTER?(g.set(this.inputNode,"value",c),this.set("value",c),this.get("results")&&this.get("results")[e]&&(b=this.get("results")[e],b.name?this.select(b):this._query({delay:0,search:b.text,magicKey:b.magicKey||null}).then(h.hitch(this,
function(a){this.select(a.results[0])})))):"keydown"===b.type&&(b.keyCode===f.BACKSPACE||b.keyCode===f.DELETE)?(m.stop(b),this.inputNode.focus(),b=this.inputNode.value.slice(0,-1),g.set(this.inputNode,"value",b),this.set("value",b)):"keydown"===b.type&&b.keyCode===f.UP_ARROW?(m.stop(b),b=e-1,0>b?this.inputNode.focus():a[b].focus()):"keydown"===b.type&&b.keyCode===f.DOWN_ARROW?(m.stop(b),b=e+1,b>=a.length?this.inputNode.focus():a[b].focus()):b.keyCode===f.ESCAPE&&this._hideMenus()}))},_geocoderMenuEvent:function(){var a=
d('[data-item\x3d"true"]',this.geocoderMenuInsertNode);this._gmEvent&&this._gmEvent.remove();this._gmEvent=n(a,"click, keydown",h.hitch(this,function(b){var e=parseInt(g.get(b.currentTarget,"data-index"),10);"click"===b.type||"keydown"===b.type&&b.keyCode===f.ENTER?(this._setActiveGeocoderIndex(null,null,e),this._hideGeolocatorMenu()):"keydown"===b.type&&b.keyCode===f.UP_ARROW?(m.stop(b),b=e-1,0>b?this.geocoderMenuArrowNode.focus():a[b].focus()):"keydown"===b.type&&b.keyCode===f.DOWN_ARROW?(m.stop(b),
b=e+1,b>=a.length?this.geocoderMenuArrowNode.focus():a[b].focus()):b.keyCode===f.ESCAPE&&this._hideGeolocatorMenu()}))},_removeEvents:function(){var a;if(this._events&&this._events.length)for(a=0;a<this._events.length;a++)this._events[a].remove();this._acEvent&&this._acEvent.remove();this._gmEvent&&this._gmEvent.remove();this._events=[]},_setupEvents:function(){this._removeEvents();var a=n(document,"click",h.hitch(this,function(a){this._hideResultsMenu(a)}));this._events.push(a);a=n(this.inputNode,
"keyup",h.hitch(this,function(a){this._inputKeyUp(a)}));this._events.push(a);a=n(this.inputNode,"keydown",h.hitch(this,function(a){this._inputKeyDown(a)}));this._events.push(a);a=n(this.geocoderMenuArrowNode,"keydown",this._geocoderMenuButtonKeyDown());this._events.push(a);this.get("map")&&(a=n(this.get("map"),"click",h.hitch(this,function(){this.blur()})),this._events.push(a));this._geocoderMenuEvent();this._autoCompleteEvent()},_findThenSelect:function(){this.find().then(h.hitch(this,function(a){a.results&&
a.results.length&&(this.select(a.results[0]),this.onEnterKeySelect())}))},_inputKeyUp:function(a){if(a){this._clearQueryTimeout();var b=this.inputNode.value;this._ignoreUpdateValue=!0;this.set("value",b);this._ignoreUpdateValue=!1;var e=0;b&&(e=b.length);if(a.ctrlKey||a.shiftKey||a.metaKey||a.altKey||a.keyCode===f.copyKey||a.keyCode===f.ALT||a.keyCode===f.CTRL||a.keyCode===f.META||a.keyCode===f.SHIFT||a.keyCode===f.UP_ARROW||a.keyCode===f.DOWN_ARROW||a.keyCode===f.LEFT_ARROW||a.keyCode===f.RIGHT_ARROW)return a;
a&&a.keyCode===f.ENTER?(this._cancelDeferreds(),this._findThenSelect()):a&&a.keyCode===f.ESCAPE?(this._cancelDeferreds(),this._hideMenus()):a&&a.keyCode===f.TAB?(this._cancelDeferreds(),this._hideMenus()):this.get("autoComplete")&&e>=this.get("minCharacters")?this._autoComplete():this._hideMenus();this._checkStatus()}},_cancelDeferreds:function(){if(this._deferreds.length){for(var a=0;a<this._deferreds.length;a++)this._deferreds[a].cancel("Geocoder:: stop query");this._deferreds=[]}},_inputKeyDown:function(a){var b=
d('[data-item\x3d"true"]',this.resultsNode);a&&a.keyCode===f.TAB?(this._cancelDeferreds(),this._hideMenus()):a&&a.keyCode===f.UP_ARROW?(m.stop(a),(a=b.length)&&b[a-1].focus()):a&&a.keyCode===f.DOWN_ARROW&&(m.stop(a),b[0]&&b[0].focus())},_geocoderMenuButtonKeyDown:function(a){var b=d('[data-item\x3d"true"]',this.geocoderMenuInsertNode);a&&a.keyCode===f.UP_ARROW?(m.stop(a),this._showGeolocatorMenu(),(a=b.length)&&b[a-1].focus()):a&&a.keyCode===f.DOWN_ARROW&&(m.stop(a),this._showGeolocatorMenu(),b[0]&&
b[0].focus())},_inputClick:function(){this._hideGeolocatorMenu();this.get("value")||(this.clear(),this._hideMenus());this._checkStatus();var a=this.get("map");a&&a.disableKeyboardNavigation()},_hydrateResult:function(a){var b={},e=this._defaultSR,c;this.get("map")&&(e=this.get("map").spatialReference);if(a.hasOwnProperty("text")&&a.hasOwnProperty("magicKey"))return a;if(a.hasOwnProperty("feature"))b.feature=new v(a.feature),(c=b.feature.geometry)&&c.setSpatialReference(e);else if(a.hasOwnProperty("geometry")){var d=
a.symbol||null;c=a.attributes||{};b.feature=new v(a.geometry,d,c,a.infoTemplate||null);(c=b.feature.geometry)&&c.setSpatialReference(e)}else a.hasOwnProperty("location")?(d=new A(a.location.x,a.location.y,e),c={},a.hasOwnProperty("attributes")&&(c=a.attributes),a.hasOwnProperty("score")&&(c.score=a.score),b.feature=new v(d,null,c,null)):b.feature=null;if(a.hasOwnProperty("extent"))b.extent=new B(a.extent),b.extent.setSpatialReference(new q(e));else if(b.feature&&b.feature.geometry)switch(b.feature.geometry.type){case "extent":b.extent=
b.feature.geometry;break;case "multipoint":b.extent=b.feature.geometry.getExtent();break;case "polygon":b.extent=b.feature.geometry.getExtent();break;case "polyline":b.extent=b.feature.geometry.getExtent();break;case "point":this.get("map")?this.get("map").getScale()>this.get("zoomScale")?b.extent=I.getExtentForScale(this.get("map"),this.get("zoomScale")).centerAt(b.feature.geometry):b.extent=this.get("map").extent.centerAt(b.feature.geometry):b.extent=new B({xmin:b.feature.geometry.x-0.25,ymin:b.feature.geometry.y-
0.25,xmax:b.feature.geometry.x+0.25,ymax:b.feature.geometry.y+0.25,spatialReference:{wkid:4326}})}else b.extent=null;a.hasOwnProperty("name")?b.name=a.name:"query"===this.activeGeocoder.type&&this.activeGeocoder.field&&a.hasOwnProperty("attributes")&&a.attributes.hasOwnProperty(this.activeGeocoder.field)?b.name=a.attributes[this.activeGeocoder.field]:a.hasOwnProperty("address")&&"string"===typeof a.address?b.name=a.address:a.hasOwnProperty("address")&&"object"===typeof a.address&&a.address.hasOwnProperty("Address")?
b.name=a.address.Address:b.name=b.feature&&b.feature.geometry?b.feature.geometry.x+","+b.feature.geometry.y:"";return b},_hydrateResults:function(a){var b=[],e=0;if(a&&a.length)for(e;e<a.length;e++){var c=this._hydrateResult(a[e]);b.push(c)}return b}})})},"esri/tasks/locator":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/has ../kernel ../request ../deferredUtils ./Task ./AddressCandidate".split(" "),function(t,s,h,u,m,g,k,p,w,f,n){return t(f,
{declaredClass:"esri.tasks.Locator",_eventMap:{"address-to-locations-complete":["addresses"],"addresses-to-locations-complete":["addresses"],"location-to-address-complete":["address"],"suggest-locations-complete":["suggestions"]},constructor:function(d){this._geocodeHandler=s.hitch(this,this._geocodeHandler);this._geocodeAddressesHandler=s.hitch(this,this._geocodeAddressesHandler);this._reverseGeocodeHandler=s.hitch(this,this._reverseGeocodeHandler);this.registerConnectEvents()},outSpatialReference:null,
setOutSpatialReference:function(d){this.outSpatialReference=d},_geocodeHandler:function(d,f,h,k,r){try{var g=d.candidates,c;f=[];var l,q=g.length,v=d.spatialReference,m;for(l=0;l<q;l++){c=g[l];if(m=c.location)m.spatialReference=v;f[l]=new n(c)}this._successHandler([f],"onAddressToLocationsComplete",h,r)}catch(p){this._errorHandler(p,k,r)}},_geocodeAddressesHandler:function(d,f,h,k,r){try{var g=d.locations;f=[];var c,l=g.length,q=d.spatialReference,v;for(c=0;c<l;c++){if(v=g[c].location)v.spatialReference=
q;f[c]=new n(g[c])}this._successHandler([f],"onAddressesToLocationsComplete",h,r)}catch(m){this._errorHandler(m,k,r)}},addressToLocations:function(d,f,h,k,g){var n,c,l,q,v,z,t;d.address&&(k=h,h=f,f=d.outFields,g=d.searchExtent,t=d.countryCode,n=d.magicKey,c=d.distance,z=d.categories,d.location&&this.normalization&&(l=d.location.normalize()),q=d.maxLocations,v=d.forStorage,d=d.address);g&&(g=g._normalize(!0));var A=this.outSpatialReference;d=this._encode(s.mixin({},this._url.query,d,{f:"json",outSR:A&&
m.toJson(A.toJson()),outFields:f&&f.join(",")||null,searchExtent:g&&m.toJson(g.toJson()),category:z&&z.join(",")||null,countryCode:t||null,magicKey:n||null,distance:c||null,location:l||null,maxLocations:q||null,forStorage:v||null}));var B=this._geocodeHandler,D=this._errorHandler,y=new u(w._dfdCanceller);y._pendingDfd=p({url:this._url.path+"/findAddressCandidates",content:d,callbackParamName:"callback",load:function(c,d){B(c,d,h,k,y)},error:function(c){D(c,k,y)}});return y},suggestLocations:function(d){var f;
f=new u;d.hasOwnProperty("location")&&this.normalization&&(d.location=d.location.normalize());d=this._encode(s.mixin({},this._url.query,{f:"json",text:d.text,category:d.categories&&d.categories.join(",")||null,location:d.location||null,distance:d.distance||null},{f:"json"}));p({url:this._url.path+"/suggest",content:d,callbackParamName:"callback"}).then(s.hitch(this,function(d){d=d.suggestions||[];this.onSuggestLocationsComplete(d);f.resolve(d)}),s.hitch(this,function(d){this._errorHandler(d);f.reject(d)}));
return f},addressesToLocations:function(d,f,g){var k=this.outSpatialReference,r=[];h.forEach(d.addresses,function(c,d){r.push({attributes:c})});d=this._encode(s.mixin({},this._url.query,{addresses:m.toJson({records:r})},{f:"json",outSR:k&&m.toJson(k.toJson())}));var n=this._geocodeAddressesHandler,c=this._errorHandler,l=new u(w._dfdCanceller);l._pendingDfd=p({url:this._url.path+"/geocodeAddresses",content:d,callbackParamName:"callback",load:function(c,d){n(c,d,f,g,l)},error:function(d){c(d,g,l)}});
return l},_reverseGeocodeHandler:function(d,f,h,g,k){try{var m=new n({address:d.address,location:d.location,score:100});this._successHandler([m],"onLocationToAddressComplete",h,k)}catch(c){this._errorHandler(c,g,k)}},locationToAddress:function(d,f,h,g){d&&this.normalization&&(d=d.normalize());var k=this.outSpatialReference;d=this._encode(s.mixin({},this._url.query,{outSR:k&&m.toJson(k.toJson()),location:d&&m.toJson(d.toJson()),distance:f,f:"json"}));var n=this._reverseGeocodeHandler,c=this._errorHandler,
l=new u(w._dfdCanceller);l._pendingDfd=p({url:this._url.path+"/reverseGeocode",content:d,callbackParamName:"callback",load:function(c,d){n(c,d,h,g,l)},error:function(d){c(d,g,l)}});return l},onSuggestLocationsComplete:function(){},onAddressToLocationsComplete:function(){},onAddressesToLocationsComplete:function(){},onLocationToAddressComplete:function(){}})})},"esri/tasks/AddressCandidate":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../geometry/Point"],function(t,
s,h,u,m){return t(null,{declaredClass:"esri.tasks.AddressCandidate",constructor:function(g){s.mixin(this,g);this.location=new m(this.location)}})})},"widgets/Geocoder/_build-generate_module":function(){define(["dojo/text!./css/style.css","dojo/i18n!./nls/strings","dojo/text!./config.json"],function(){})},"url:esri/dijit/templates/Geocoder.html":'\x3cdiv class\x3d"${theme}" role\x3d"presentation"\x3e\n    \x3cdiv class\x3d"${_css.GeocoderContainerClass}" role\x3d"presentation"\x3e\n    \t\x3cdiv class\x3d"${_css.GeocoderClass}" data-dojo-attach-point\x3d"containerNode" role\x3d"presentation"\x3e\n    \t\t\x3cdiv title\x3d"${_i18n.widgets.Geocoder.main.searchButtonTitle}" tabindex\x3d"0" class\x3d"${_css.searchButtonClass} ${_css.GeocoderIconClass}" data-dojo-attach-point\x3d"submitNode" role\x3d"button"\x3e\x3c/div\x3e\n    \t\t\x3cdiv aria-haspopup\x3d"true" id\x3d"${id}_menu_button" title\x3d"${_i18n.widgets.Geocoder.main.geocoderMenuButtonTitle}" tabindex\x3d"0" class\x3d"${_css.geocoderMenuArrowClass} ${_css.GeocoderIconClass}" data-dojo-attach-point\x3d"geocoderMenuArrowNode" role\x3d"button" aria-expanded\x3d"false"\x3e\x3c/div\x3e\n    \t\t\x3cinput aria-haspopup\x3d"true" id\x3d"${id}_input" tabindex\x3d"0" placeholder\x3d"" value\x3d"${value}" autocomplete\x3d"off" type\x3d"text" data-dojo-attach-point\x3d"inputNode" role\x3d"textbox"\x3e\n    \t\t\x3cdiv tabindex\x3d"0" class\x3d"${_css.clearButtonClass} ${_css.GeocoderIconClass}" data-dojo-attach-point\x3d"clearNode" role\x3d"button"\x3e\x3c/div\x3e\n    \t\t\x3cdiv class\x3d"${_css.GeocoderClearClass}" role\x3d"presentation"\x3e\x3c/div\x3e\n    \t\x3c/div\x3e\n    \t\x3cdiv class\x3d"${_css.resultsContainerClass}" data-dojo-attach-point\x3d"resultsNode" aria-labelledby\x3d"${id}_input" role\x3d"menu" aria-hidden\x3d"true"\x3e\x3c/div\x3e\n    \t\x3cdiv class\x3d"${_css.geocoderMenuClass}" data-dojo-attach-point\x3d"geocoderMenuNode" role\x3d"presentation"\x3e\n    \t\t\x3cdiv class\x3d"${_css.geocoderMenuHeaderClass}"\x3e\n    \t\t\t${_i18n.widgets.Geocoder.main.geocoderMenuHeader}\n    \t\t\t\x3cdiv role\x3d"button" data-dojo-attach-point\x3d"geocoderMenuCloseNode" title\x3d"${_i18n.widgets.Geocoder.main.geocoderMenuCloseTitle}" tabindex\x3d"0" class\x3d"${_css.geocoderMenuCloseClass}"\x3e\x3c/div\x3e\n    \t\t\t\x3cdiv class\x3d"${_css.GeocoderClearClass}" role\x3d"presentation"\x3e\x3c/div\x3e\n    \t\t\x3c/div\x3e\n    \t\t\x3cdiv data-dojo-attach-point\x3d"geocoderMenuInsertNode" aria-labelledby\x3d"${id}_menu_button" role\x3d"menu" aria-hidden\x3d"true"\x3e\x3c/div\x3e\n    \t\x3c/div\x3e\n    \x3c/div\x3e\n\x3c/div\x3e',
"url:widgets/Geocoder/css/style.css":".jimu-widget-geocoder{width: 225px; height: 30px; background-color: rgba(72, 85, 102, 0.5); border-radius: 5px;}.jimu-widget-geocoder .simpleGeocoder .esriGeocoder {border: 1px solid #666; opacity: 0.9;}.jimu-widget-geocoder .simpleGeocoder .esriGeocoderResults{border: 1px solid #666;}.esriPopup .titlePane {background-color: #5491B8; border-color: #777777;}.esriPopup .sizer {width: 400px;}","url:widgets/Geocoder/config.json":'{\n  "geocoder": {\n    "autoComplete": true,\n    "minCharacters": 3,\n    "arcgisGeocoder": {\n      "placeholder": "Find address or place"\n    }\n  }\n}',
"*now":function(t){t(['dojo/i18n!*preload*widgets/Geocoder/nls/Widget*["ar","cs","da","de","en","es","et","fi","fr","he","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sv","th","tr","zh-cn","ROOT"]'])}}});
define("dojo/_base/declare dojo/_base/array jimu/BaseWidget esri/dijit/Geocoder dojo/_base/html dojo/on dojo/_base/lang dojo/Deferred dojo/promise/all jimu/portalUtils jimu/dijit/Message libs/usng/usng esri/request esri/geometry/Extent esri/graphic esri/geometry/Point esri/SpatialReference".split(" "),function(t,s,h,u,m,g,k,p,w,f,n,d,x,E,F,r,C){return t([h],{name:"Geocoder",baseClass:"jimu-widget-geocoder",defaultGeocodeUrl:"arcgis.com/arcgis/rest/services/World/GeocodeServer",lastMgrsResult:null,
postCreate:function(){this.inherited(arguments)},startup:function(){this.inherited(arguments);this._initGeocoder()},_initGeocoder:function(){this._getGeocoders(this.appConfig.portalUrl).then(k.hitch(this,function(){var c=this.config.geocoder;c.map=this.map;c=new u(c);this.own(g(c,"select",k.hitch(this,"findComplete")));this.own(g(c,"auto-complete",k.hitch(this,"onFindResults")));this.own(g(c,"find-results",k.hitch(this,"onFindResults")));m.place(c.domNode,this.domNode);c.startup()}),k.hitch(this,
function(c){console.error(c)}))},_getGeocodeName:function(c){if("string"!==typeof c)return"geocoder";c=c.split("/");return c[c.length-2]||"geocoder"},_getSingleLine:function(c){var d=new p;c.singleLineFieldName?d.resolve(c):x({url:c.url,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}).then(k.hitch(this,function(f){f.singleLineAddressField&&f.singleLineAddressField.name?(c.singleLineFieldName=f.singleLineAddressField.name,d.resolve(c)):(console.warn(c.url+"has no singleLineFieldName"),
d.resolve(null))}),k.hitch(this,function(c){console.error(c);d.resolve(null)}));return d},_getGeocoders:function(c){var d=new p;if(this.config.geocoder&&this.config.geocoder.geocoders&&this.config.geocoder.geocoders.length)return d.resolve("success"),d;f.getPortalSelfInfo(c).then(k.hitch(this,function(c){c=c.helperServices&&c.helperServices.geocode;var f=[],g=[];if(c&&0<c.length){for(var h=0,m=c.length;h<m;h++){var n=c[h];n&&g.push(this._getSingleLine(n))}w(g).then(k.hitch(this,function(c){for(var h=
0;h<c.length;h++){var g=c[h];g&&(g={name:g.name||this._getGeocodeName(g.url),url:g.url,singleLineFieldName:g.singleLineFieldName,placeholder:g.placeholder||g.name||this._getGeocodeName(g.url)},f.push(g))}this.config.geocoder.geocoders=f;this.config.geocoder.arcgisGeocoder=0===f.length?!0:!1;d.resolve("success")}))}else this.config.geocoder.arcgisGeocoder=!0,console.error("portal doesn't configure geocode, use arcgisGeocoder instead"),d.resolve("success")}),k.hitch(this,function(c){new n({message:this.nls.portalConnectionError});
d.reject("error");console.error(c)}));return d},lookupMgrs:function(c){var f=null;try{var g=[];d.USNGtoLL(c,g);f=2<=g.length&&!isNaN(g[0])&&!isNaN(g[1])?{text:c.toUpperCase(),latitude:g[0],longitude:g[1]}:null}catch(h){f=null}return f},onFindResults:function(c){this.lastMgrsResult=this.lookupMgrs(c.results.value);if(null!==this.lastMgrsResult){var d=new r(this.lastMgrsResult.longitude,this.lastMgrsResult.latitude,new C({wkid:4326})),f=this.map.extent.centerAt(d),d=new F(d);c.results.results.unshift({extent:f,
feature:d,name:this.lastMgrsResult.text})}},findComplete:function(c){var d=c.target;d.autoNavigate=!0;var f=null,g=null,h=null;c&&c.result?(f=c.result.feature,g=c.result.extent,h=c.result.name):this.lastMgrsResult&&(f={geometry:new r(this.lastMgrsResult.longitude,this.lastMgrsResult.latitude)},h=this.lastMgrsResult.text);f?(this.map.infoWindow.setTitle("Location"),this.map.infoWindow.setContent(h||null),this.map.infoWindow.show(f.geometry)):g&&this.map.setExtent(g);this.lastMgrsResult&&(this.map.centerAt(f.geometry),
d.autoNavigate=!1)}})});