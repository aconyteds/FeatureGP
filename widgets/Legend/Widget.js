//>>built
require({cache:{"esri/dijit/Legend":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/json dojo/_base/Color dojo/has dojo/sniff dojo/DeferredList dojo/json dojo/number dojo/dom dojo/dom-construct dojo/dom-style dijit/_Widget dojox/gfx dojox/gfx/matrix dojox/html/entities ../kernel ../config ../request ../lang ../renderers/SimpleRenderer ../renderers/UniqueValueRenderer ../renderers/ClassBreaksRenderer ../renderers/ScaleDependentRenderer ../renderers/DotDensityRenderer ../renderers/TemporalRenderer ../symbols/SimpleMarkerSymbol ../symbols/PictureFillSymbol ../symbols/jsonUtils ./_EventedWidget dojo/i18n!../nls/jsapi dojo/i18n!dojo/cldr/nls/number".split(" "),
function(y,x,u,l,d,f,z,n,s,h,r,t,m,e,p,J,E,K,L,U,F,G,D,B,H,I,M,N,O,P,Q,C,R,S,T){var A=x([R,J],{declaredClass:"esri.dijit.Legend",widgetsInTemplate:!1,layers:null,alignRight:!1,hoverLabelShowing:!1,dotDensitySwatchSize:26,dotCoverage:75,reZeros:RegExp("\\"+T.decimal+"0+$","g"),reZerosFractional:RegExp("(\\d)0*$","g"),_ieTimer:100,_isRightToLeft:!1,_align:null,_legendAlign:null,constructor:function(a,b){u.mixin(this,S.widgets.legend);a=a||{};a.map?b?(this.map=a.map,this.layerInfos=a.layerInfos,this._respectCurrentMapScale=
!1===a.respectCurrentMapScale?!1:!0,this.arrangement=a.arrangement===A.ALIGN_RIGHT?A.ALIGN_RIGHT:A.ALIGN_LEFT,this.arrangement===A.ALIGN_RIGHT&&(this.alignRight=!0),this.autoUpdate=!1===a.autoUpdate?!1:!0,this._surfaceItems=[]):console.error("esri.dijit.Legend: must specify a container for the legend"):console.error("esri.dijit.Legend: unable to find the 'map' property in parameters")},postMixInProperties:function(){this.inherited(arguments);var a=["ar","he"],b,c;for(b=0;b<a.length;b+=1)c=a[b],y.locale&&
-1!==y.locale.indexOf(c)&&(-1!==y.locale.indexOf("-")?-1!==y.locale.indexOf(c+"-")&&(this._isRightToLeft=!0):this._isRightToLeft=!0);this._isRightToLeft?(this._align=this.alignRight?"left":"right",this._legendAlign=this.alignRight?"esriLegendLeft":"esriLegendRight"):(this._align=this.alignRight?"right":"left",this._legendAlign=this.alignRight?"esriLegendRight":"esriLegendLeft")},startup:function(){this.inherited(arguments);this._initialize();9>n("ie")&&(this._repaintItems=u.hitch(this,this._repaintItems),
setTimeout(this._repaintItems,this._ieTimer))},destroy:function(){this._deactivate();this._removeHoverHandlers();this.inherited(arguments)},refresh:function(a){if(this.domNode){a?(this.layerInfos=a,this.layers=[],l.forEach(this.layerInfos,function(a){this._isSupportedLayerType(a.layer)&&(a.title&&(a.layer._titleForLegend=a.title),a.layer._hideDefaultSymbol=!1===a.defaultSymbol?!0:!1,a.hideLayers?(a.layer._hideLayersInLegend=a.hideLayers,this._addSubLayersToHide(a)):a.layer._hideLayersInLegend=[],
a.hoverLabel&&(a.layer._hoverLabel=a.hoverLabel),a.hoverLabels&&(a.layer._hoverLabels=a.hoverLabels),this.layers.push(a.layer))},this)):this.useAllMapLayers&&(this.layers=this.layerInfos=null);for(a=this.domNode.children.length-1;0<=a;a--)e.destroy(this.domNode.children[a]);this._removeHoverHandlers();this.startup()}},_legendUrl:"http://utility.arcgis.com/sharing/tools/legend",_initialize:function(){this.layerInfos&&(this.layers=[],l.forEach(this.layerInfos,function(a){this._isSupportedLayerType(a.layer)&&
(a.title&&(a.layer._titleForLegend=a.title),a.layer._hideDefaultSymbol=!1===a.defaultSymbol?!0:!1,a.hideLayers?(a.layer._hideLayersInLegend=a.hideLayers,this._addSubLayersToHide(a)):a.layer._hideLayersInLegend=[],a.hoverLabel&&(a.layer._hoverLabel=a.hoverLabel),a.hoverLabels&&(a.layer._hoverLabels=a.hoverLabels),this.layers.push(a.layer))},this));this.useAllMapLayers=!1;if(!this.layers){this.useAllMapLayers=!0;this.layers=[];var a=[],b=[];l.forEach(this.map.layerIds,function(c){c=this.map.getLayer(c);
var g;this._isSupportedLayerType(c)&&(c.arcgisProps&&c.arcgisProps.title&&(c._titleForLegend=c.arcgisProps.title),this.layers.push(c));"esri.layers.KMLLayer"==c.declaredClass&&(g=c.getLayers(),l.forEach(g,function(b){a.push(b.id)},this));"esri.layers.GeoRSSLayer"==c.declaredClass&&(g=c.getFeatureLayers(),l.forEach(g,function(a){b.push(a.id)},this))},this);l.forEach(this.map.graphicsLayerIds,function(c){var g=this.map.getLayer(c);-1==l.indexOf(a,c)&&-1==l.indexOf(b,c)&&(this._isSupportedLayerType(g)&&
g._params&&g._params.drawMode)&&(g.arcgisProps&&g.arcgisProps.title&&(g._titleForLegend=g.arcgisProps.title),this.layers.push(g))},this)}this._createLegend()},_activate:function(){this._deactivate();this.autoUpdate&&(this._respectCurrentMapScale&&(this._ozeConnect=d.connect(this.map,"onZoomEnd",this,"_refreshLayers")),this.useAllMapLayers&&(this._olaConnect=d.connect(this.map,"onLayerAdd",this,"_updateAllMapLayers"),this._olrConnect=d.connect(this.map,"onLayerRemove",this,"_updateAllMapLayers"),this._olroConnect=
d.connect(this.map,"onLayersReordered",this,"_updateAllMapLayers")),l.forEach(this.layers,function(a){a.ovcConnect=d.connect(a,"onVisibilityChange",this,"_refreshLayers");a.oscConnect=d.connect(a,"onScaleRangeChange",this,"_refreshLayers");"esri.layers.ArcGISDynamicMapServiceLayer"===a.declaredClass&&a.supportsDynamicLayers&&(a.odcConnect=d.connect(a,"_onDynamicLayersChange",u.hitch(this,"_updateDynamicLayers",a)));"esri.layers.ArcGISImageServiceLayer"===a.declaredClass&&(a.oirConnect=d.connect(a,
"onRenderingChange",u.partial(this._updateImageServiceLayers,this,a)))},this))},_deactivate:function(){this._ozeConnect&&d.disconnect(this._ozeConnect);this._olaConnect&&d.disconnect(this._olaConnect);this._olroConnect&&d.disconnect(this._olroConnect);this._olrConnect&&d.disconnect(this._olrConnect);l.forEach(this.layers,function(a){a.ovcConnect&&d.disconnect(a.ovcConnect);a.oscConnect&&d.disconnect(a.oscConnect);a.odcConnect&&d.disconnect(a.odcConnect);a.oirConnect&&d.disconnect(a.oirConnect)},this)},
_updateDynamicLayers:function(a){delete a.legendResponse;this._refreshLayers()},_updateImageServiceLayers:function(a,b){delete b.legendResponse;a._refreshLayers()},_refreshLayers:function(){this.refresh()},_updateAllMapLayers:function(){this.layers=[];l.forEach(this.map.layerIds,function(a){a=this.map.getLayer(a);this._isSupportedLayerType(a)&&this.layers.push(a)},this);l.forEach(this.map.graphicsLayerIds,function(a){a=this.map.getLayer(a);this._isSupportedLayerType(a)&&(a._params&&a._params.drawMode)&&
this.layers.push(a)},this);this.refresh()},_createLegend:function(){var a=!1;p.set(this.domNode,"position","relative");e.create("div",{id:this.id+"_msg",className:"esriLegendMsg",innerHTML:this.NLS_creatingLegend+"..."},this.domNode);var b=[];l.forEach(this.layers,function(c){if("esri.layers.KMLLayer"==c.declaredClass||"esri.layers.GeoRSSLayer"==c.declaredClass){var q;c.loaded?("esri.layers.KMLLayer"==c.declaredClass?q=c.getLayers():"esri.layers.GeoRSSLayer"==c.declaredClass&&(q=c.getFeatureLayers(),
c._hideLayersInLegend&&(q=l.filter(q,function(a){return-1==l.indexOf(c._hideLayersInLegend,a.id)}))),l.forEach(q,function(a){"esri.layers.FeatureLayer"==a.declaredClass&&c._titleForLegend&&(a._titleForLegend=c._titleForLegend+" - ","esriGeometryPoint"==a.geometryType?a._titleForLegend+=this.NLS_points:"esriGeometryPolyline"==a.geometryType?a._titleForLegend+=this.NLS_lines:"esriGeometryPolygon"==a.geometryType&&(a._titleForLegend+=this.NLS_polygons),b.push(a))},this)):d.connect(c,"onLoad",u.hitch(this,
function(){this.refresh(this.layerInfos)}))}else if("esri.layers.WMSLayer"===c.declaredClass)if(c.loaded){if(c.visible&&0<c.layerInfos.length&&l.some(c.layerInfos,function(a){return a.legendURL})){var w=!1;l.forEach(c.layerInfos,function(b){b.legendURL&&-1<l.indexOf(c.visibleLayers,b.name)&&(w||(e.create("div",{innerHTML:"\x3cspan class\x3d'esriLegendServiceLabel'\x3e"+(c._titleForLegend||c.name||c.id)+"\x3c/span\x3e"},this.domNode),w=!0),e.create("div",{innerHTML:"\x3cimg src\x3d'"+b.legendURL+"'/\x3e"},
this.domNode),a=!0)},this)}}else d.connect(c,"onLoad",u.hitch(this,function(){this.refresh(this.layerInfos)}));else b.push(c)},this);var c=[];l.forEach(b,function(a){if(a.loaded){if(!0===a.visible&&(a.layerInfos||a.renderer||"esri.layers.ArcGISImageServiceLayer"==a.declaredClass)){var b=e.create("div",{id:this.id+"_"+a.id,style:{display:"none"},"class":"esriLegendService"});e.create("span",{innerHTML:this._getServiceTitle(a),"class":"esriLegendServiceLabel"},e.create("td",{align:this._align},e.create("tr",
{},e.create("tbody",{},e.create("table",{width:"95%"},b)))));e.place(b,this.id,"first");a.legendResponse||a.renderer?this._createLegendForLayer(a):c.push(this._legendRequest(a))}}else var w=d.connect(a,"onLoad",this,function(a){d.disconnect(w);w=null;this.refresh()})},this);0===c.length&&!a?(m.byId(this.id+"_msg").innerHTML=this.NLS_noLegend,this._activate()):(new h(c)).addCallback(u.hitch(this,function(b){a?m.byId(this.id+"_msg").innerHTML="":m.byId(this.id+"_msg").innerHTML=this.NLS_noLegend;this._activate()}))},
_createLegendForLayer:function(a){if(a.legendResponse||a.renderer){var b=!1;if(a.legendResponse){var c=a.dynamicLayerInfos||a.layerInfos;c&&c.length?l.forEach(c,function(c,q){if(!a._hideLayersInLegend||-1==l.indexOf(a._hideLayersInLegend,c.id)){var e=this._buildLegendItems(a,c,q);b=b||e}},this):"esri.layers.ArcGISImageServiceLayer"==a.declaredClass&&(b=this._buildLegendItems(a,{id:0,name:null,title:a.name,subLayerIds:null,parentLayerId:-1},0))}else a.renderer&&(c=a.url?a.url.substring(a.url.lastIndexOf("/")+
1,a.url.length):"fc_"+a.id,b=this._buildLegendItems(a,{id:c,name:null,subLayerIds:null,parentLayerId:-1},0));b&&(p.set(m.byId(this.id+"_"+a.id),"display","block"),p.set(m.byId(this.id+"_msg"),"display","none"))}},_legendRequest:function(a){if(a.loaded)return 10.01<=a.version?this._legendRequestServer(a):this._legendRequestTools(a);d.connect(a,"onLoad",u.hitch(this,"_legendRequest"))},_legendRequestServer:function(a){var b=a.url,c=b.indexOf("?"),b=-1<c?b.substring(0,c)+"/legend"+b.substring(c):b+"/legend";
(c=a._getToken())&&(b+="?token\x3d"+c);var g=u.hitch(this,"_processLegendResponse"),c={f:"json"};a._params.dynamicLayers&&(c.dynamicLayers=r.stringify(this._createDynamicLayers(a)),"[{}]"===c.dynamicLayers&&(c.dynamicLayers="[]"));a._params.bandIds&&(c.bandIds=a._params.bandIds);a._params.renderingRule&&(c.renderingRule=a._params.renderingRule);return G({url:b,content:c,callbackParamName:"callback",load:function(b,c){g(a,b,c)},error:F.defaults.io.errorHandler})},_legendRequestTools:function(a){var b=
a.url.toLowerCase().indexOf("/rest/"),b=a.url.substring(0,b)+a.url.substring(b+5,a.url.length),b=this._legendUrl+"?soapUrl\x3d"+window.escape(b);if(!n("ie")||8<n("ie"))b+="\x26returnbytes\x3dtrue";var c=u.hitch(this,"_processLegendResponse");return G({url:b,content:{f:"json"},callbackParamName:"callback",load:function(b,e){c(a,b,e)},error:F.defaults.io.errorHandler})},_processLegendResponse:function(a,b){b&&b.layers?(a.legendResponse=b,m.byId(this.id+"_"+a.id)&&e.empty(m.byId(this.id+"_"+a.id)),e.create("span",
{innerHTML:this._getServiceTitle(a),"class":"esriLegendServiceLabel"},e.create("td",{align:this._align},e.create("tr",{},e.create("tbody",{},e.create("table",{width:"95%"},m.byId(this.id+"_"+a.id)))))),this._createLegendForLayer(a)):console.log("Legend could not get generated for "+a.url+": "+f.toJson(b))},_buildLegendItems:function(a,b,c){var g=!1,q=m.byId(this.id+"_"+a.id),w=b.parentLayerId;if(b.subLayerIds)a=e.create("div",{id:this.id+"_"+a.id+"_"+b.id+"_group",style:{display:"none"},"class":-1==
w?0<c?"esriLegendGroupLayer":"":this._legendAlign},-1==w?q:m.byId(this.id+"_"+a.id+"_"+w+"_group")),e.create("td",{innerHTML:b.name,align:this._align},e.create("tr",{},e.create("tbody",{},e.create("table",{width:"95%","class":"esriLegendLayerLabel"},a))));else{if(a.visibleLayers&&-1==(","+a.visibleLayers+",").indexOf(","+b.id+","))return g;c=e.create("div",{id:this.id+"_"+a.id+"_"+b.id,style:{display:"none"},"class":-1<w?this._legendAlign:""},-1==w?q:m.byId(this.id+"_"+a.id+"_"+w+"_group"));e.create("td",
{innerHTML:b.name||"",align:this._align},e.create("tr",{},e.create("tbody",{},e.create("table",{width:"95%","class":"esriLegendLayerLabel"},c))));a.legendResponse?g=g||this._buildLegendItems_Tools(a,b,c):a.renderer&&(g=g||this._buildLegendItems_Renderer(a,b,c))}return g},_buildLegendItems_Tools:function(a,b,c){var g=b.parentLayerId,q=this.map.getScale(),w=!1,h=function(a,b){var c,g;for(c=0;c<a.length;c++)if(b.dynamicLayerInfos)for(g=0;g<b.dynamicLayerInfos[g].length;g++){if(b.dynamicLayerInfos[g].mapLayerId==
a[c].layerId)return a[c]}else if(b.id==a[c].layerId)return a[c];return{}};if(!this._respectCurrentMapScale||this._respectCurrentMapScale&&this._isLayerInScale(a,b,q)){var v=!0;if("esri.layers.ArcGISDynamicMapServiceLayer"===a.declaredClass||"esri.layers.ArcGISMapServiceLayer"===a.declaredClass){var k=this._getEffectiveScale(a,b);if(k.minScale&&k.minScale<q||k.maxScale&&k.maxScale>q)v=!1}if(v){var q=h(a.legendResponse.layers,b),f=q.legendType,d=q.legend;if(d){c=e.create("table",{cellpadding:0,cellspacing:0,
width:"95%","class":"esriLegendLayer"},c);var r=e.create("tbody",{},c);(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(c,a,b);l.forEach(d,function(c){if(!(10.1<=a.version&&!c.values&&1<d.length&&(a._hideDefaultSymbol||"\x3call other values\x3e"===c.label||!c.label&&!("esri.layers.ArcGISImageServiceLayer"===a.declaredClass&&10.3<=a.version))))if(c.url&&0===c.url.indexOf("http")||c.imageData&&0<c.imageData.length)w=!0,this._buildRow_Tools(c,r,a,b.id,f)},this)}}}w&&(p.set(m.byId(this.id+"_"+
a.id+"_"+b.id),"display","block"),-1<g&&(p.set(m.byId(this.id+"_"+a.id+"_"+g+"_group"),"display","block"),this._findParentGroup(a.id,a,g)));return w},_buildRow_Tools:function(a,b,c,g,q){var w=e.create("tr",{},b),h;this.alignRight?(b=e.create("td",{align:this._isRightToLeft?"left":"right"},w),h=e.create("td",{align:this._isRightToLeft?"left":"right",width:35},w)):(h=e.create("td",{width:35},w),b=e.create("td",{},w));w=a.url;(!n("ie")||9<=n("ie")||9>n("ie")&&"esri.layers.ArcGISImageServiceLayer"===
c.declaredClass)&&a.imageData&&0<a.imageData.length?w="data:image/png;base64,"+a.imageData:0!==a.url.indexOf("http")&&(w=c.url+"/"+g+"/images/"+a.url,(g=c._getToken())&&(w+="?token\x3d"+g));g=e.create("img",{src:w,border:0,style:"opacity:"+c.opacity},h);a=e.create("td",{innerHTML:a.label,align:this._align},e.create("tr",{},e.create("tbody",{},e.create("table",{width:"95%",dir:"ltr"},b))));q&&("Stretched"===q&&10.3<=c.version&&"esri.layers.ArcGISImageServiceLayer"===c.declaredClass)&&(a.style.verticalAlign=
"top",a.style.lineHeight="1",g.style.marginBottom="-1px",g.style.display="block",b.style.verticalAlign="top");9>n("ie")&&(g.style.filter="alpha(opacity\x3d"+100*c.opacity+")")},_buildLegendItems_Renderer:function(a,b,c){var g=b.parentLayerId,q=this.map,w=q.getScale(),h=!1;if(!this._respectCurrentMapScale||this._isLayerInScale(a,b,w)){var v,k=a.renderer,f,d,r,n,t;if(k instanceof M&&(k=(k="zoom"===k.rangeType?k.getRendererInfoByZoom(q.getZoom()):k.getRendererInfoByScale(w))&&k.renderer,!k))return!1;
k.colorInfo?(f=this._getMedianColor(k),r=u.isFunction(k.colorInfo.field)?null:a._getField(k.colorInfo.field,!0)):k.opacityInfo&&(t=u.isFunction(k.opacityInfo.field)?null:a._getField(k.opacityInfo.field,!0));k.proportionalSymbolInfo&&(n=u.isFunction(k.proportionalSymbolInfo.field)?null:a._getField(k.proportionalSymbolInfo.field,!0));if(k instanceof N)h=!0,this._showDotDensityLegend(a,b,k,c);else if(k instanceof O)h=!0,q=e.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},
c),v=e.create("tbody",{},q),(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(q,a,b),k.latestObservationRenderer&&k.latestObservationRenderer instanceof B&&this._buildRow_Renderer(a,k.latestObservationRenderer.symbol,f,k.latestObservationRenderer.label||this.NLS_currentObservations,null,v),k.observationRenderer&&k.observationRenderer instanceof B&&this._buildRow_Renderer(a,k.observationRenderer.symbol,f,k.observationRenderer.label||this.NLS_previousObservations,null,v);else if(k instanceof
H){if(k.infos&&0<k.infos.length){h=!0;q=e.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},c);v=e.create("tbody",{},q);(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(q,a,b);var z=[];l.forEach(k.infos,function(b){var c=null;a._editable&&a.types&&(c=this._getTemplateFromTypes(a.types,b.value));var g=b.label;null==g&&(g=b.value);-1===l.indexOf(z,g)&&(z.push(g),this._buildRow_Renderer(a,b.symbol,f,g,c,v))},this)}}else k instanceof I?k.infos&&0<k.infos.length&&
(h=!0,q=e.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},c),v=e.create("tbody",{},q),(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(q,a,b),l.forEach(k.infos,function(b){var c=b.label;null==c&&(c=b.minValue+" - "+b.maxValue);this._buildRow_Renderer(a,b.symbol,f,c,null,v)},this)):k instanceof B&&(h=!0,q=e.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},c),v=e.create("tbody",{},q),(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(q,
a,b),d=null,a._editable&&(a.templates&&0<a.templates.length)&&(d=a.templates[0]),q=(r||t)&&n?null:r||t||n,this._buildRow_Renderer(a,k.symbol,f,q?q.alias||q.name:k.label,d,v),d=k.symbol&&k.symbol.color,q&&(r=t=n=null));h&&(k.colorInfo?this._showColorRamp(a,b,k,null,c,k.colorInfo,r):k.opacityInfo&&d&&this._showColorRamp(a,b,k,d,c,k.opacityInfo,t),k.proportionalSymbolInfo&&this._showProportionalLegend(a,b,k,f,c,n));!a._hideDefaultSymbol&&k.defaultSymbol&&(h=!0,this._buildRow_Renderer(a,k.defaultSymbol,
null,k.defaultLabel||"others",null,v))}h&&(p.set(m.byId(this.id+"_"+a.id+"_"+b.id),"display","block"),-1<g&&(p.set(m.byId(this.id+"_"+a.id+"_"+g+"_group"),"display","block"),this._findParentGroup(a.id,g)));return h},_showColorRamp:function(a,b,c,g,q,h,f){var v;v=e.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},q);q=e.create("tbody",{},v);(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(v,a,b);f&&this._addSubHeader(q,f.alias||f.name);b=this._getRampStops(c,
h,g);b.length&&this._drawColorRamp(q,b,a)},_getMedianColor:function(a){var b=a.colorInfo,c,g;b.colors?(c=b.minDataValue,g=b.maxDataValue):b.stops&&(c=b.stops[0].value,g=b.stops[b.stops.length-1].value);return a.getColor(c+(g-c)/2)},_getRampStops:function(a,b,c){var g,e,h;b.colors||b.opacityValues?(e=b.maxDataValue-b.minDataValue,g=l.map([0,0.25,0.5,0.75,1],function(a){h=b.minDataValue+a*e;return Number(h.toFixed(6))}),this._checkPrecision(0,4,g)):b.stops&&(g=l.map(b.stops,function(a){return a.value}));
var f=g[0],v,k;e=g[g.length-1]-f;return l.map(g,function(b){c?(v=new z(c.toRgba()),k=a.getOpacity(b),null!=k&&(v.a=k)):v=a.getColor(b);return{value:b,color:v,offset:1-(b-f)/e,label:t.format(b,{places:20,round:-1}).replace(this.reZerosFractional,"$1").replace(this.reZeros,"")}},this).reverse()},_checkPrecision:function(a,b,c){var g=a+(b-a)/2,e=c[a],h=c[g],f=c[b],v=Math.floor(e),k=Math.floor(h),m=Math.floor(f);v===e&&(m===f&&k!==h&&v!==k&&m!==k)&&(c[g]=k);a+1!==g&&this._checkPrecision(a,g,c);g+1!==
b&&this._checkPrecision(g,b,c)},_drawColorRamp:function(a,b,c){var g=e.create("tr",{},a),h,f,m,v,k,d,r;this.alignRight?(a=e.create("td",{align:this._isRightToLeft?"left":"right"},g),h=e.create("td",{align:this._isRightToLeft?"left":"right",width:34},g)):(h=e.create("td",{width:34,align:"center"},g),a=e.create("td",{},g));f=e.create("div",{style:"position: relative; width:34px;"},h);m=e.create("div",{"class":"esriLegendColorRamp"},f);g=p.get(m,"width");h=p.get(m,"height");p.set(f,"height",h+"px");
m=E.createSurface(m,g,h);9>n("ie")&&(k=m.getEventSource(),p.set(k,"position","relative"),p.set(k.parentNode,"position","relative"));try{d=m.createRect({width:g,height:h}),d.setFill({type:"linear",x1:0,y1:0,x2:0,y2:h,colors:b}).setStroke(null),m.createRect({width:g,height:h}).setFill(new z([255,255,255,1-c.opacity])).setStroke(null),this._surfaceItems.push(m)}catch(t){m.clear(),m.destroy()}v=e.create("div",{"class":"esriLegendColorRampLabels"},a);l.forEach(b,function(a,c){r="top:"+100*a.offset+"%;";
e.create("div",{"class":"esriLegendColorRampTick"+(c===b.length-1?" esriLegendColorRampTickLast":""),innerHTML:"\x26nbsp;",style:r},f);e.create("div",{"class":"esriLegendColorRampLabel",innerHTML:a.label,style:r},v)})},_showDotDensityLegend:function(a,b,c,g){var h=c.legendOptions,f,m,v,k,d,r,n,t=this.dotDensitySwatchSize,p=Math.round(t/2);h&&(m=h.backgroundColor,v=h.outline,k=h.valueUnit,d=h.dotCoverage);d=(d||this.dotCoverage)/100;n=Math.round(t*t/Math.pow(c.dotSize,2)*d);g=e.create("table",{cellpadding:0,
cellspacing:0,width:"95%","class":"esriLegendLayer"},g);r=e.create("tbody",{},g);(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(g,a,b);this._addSubHeader(r,D.substitute({value:c.dotValue,unit:k||""},this.NLS_dotValue));l.forEach(c.fields,function(b){b=u.mixin({},b);b.numPoints=n;f=new Q(c._generateImageSrc(t,t,[b],{x:0,y:0},{x:t,y:t},m),v||c.outline,t,t);b=a._getField(b.name,!0)||b;this._buildRow_Renderer(a,f,null,b.alias||b.name,null,r,{type:"path",path:"M "+-p+","+-p+" L "+p+","+-p+" L "+
p+","+p+" L "+-p+","+p+" L "+-p+","+-p+" E"})},this)},_showProportionalLegend:function(a,b,c,g,h,f){var m=c.proportionalSymbolInfo,d=m.legendOptions,d=d&&d.customValues,k,r=m.minDataValue,p=m.maxDataValue,n=this._getProportionalSymbol(c,g);"unknown"!==m.valueUnit||(!n||!d&&(null==r||null==p))||(g=e.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},h),k=e.create("tbody",{},g),(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(g,a,b),f&&this._addSubHeader(k,f.alias||
f.name),b=d||this._getDataValues(r,p),l.forEach(b,function(b){n=C.fromJson(n.toJson());this._applySize(n,c,b);b=t.format(b,{places:20,round:-1}).replace(this.reZerosFractional,"$1").replace(this.reZeros,"");this._buildRow_Renderer(a,n,null,b,null,k)},this))},_getProportionalSymbol:function(a,b){var c,g;if(a instanceof B)g=!0,c=a.symbol;else if(a instanceof H||a instanceof I)c=a.infos[0].symbol;if(c=-1!==c.type.indexOf("fillsymbol")?null:c)!g&&"picturemarkersymbol"===c.type?(c=new P,c.setStyle("square"),
c.outline.setWidth(1)):c=C.fromJson(c.toJson()),b?c.setColor(new z(b.toRgba())):g||c.setColor(new z([127,127,127]));return c},_applySize:function(a,b,c){var g=a.type;b=b.getSize(c,-1!==g.indexOf("markersymbol")?{shape:a.style}:null);switch(g){case "simplemarkersymbol":a.setSize(b);break;case "picturemarkersymbol":a.setWidth(b);a.setHeight(b);break;case "simplelinesymbol":case "cartographiclinesymbol":a.setWidth(b)}},_getDataValues:function(a,b){var c=[a,b],g=Math.LN10,h=Math.log(a),e=Math.log(b),
f,m,k,d,r;l.forEach([1,2.5,5],function(a){d=Math.log(a);f=Math.ceil((h-d)/g);m=Math.floor((e-d)/g);if(!(Infinity===Math.abs(f)||Infinity===Math.abs(m)))for(k=f;k<m+1;k++)r=a*Math.pow(10,k),-1===l.indexOf(c,r)&&c.push(r)});c.sort(this._sorter);return c.reverse()},_sorter:function(a,b){return a-b},_buildRow_Renderer:function(a,b,c,g,h,f,m){var d=e.create("tr",{},f),k;this.alignRight?(f=e.create("td",{align:this._isRightToLeft?"left":"right"},d),k=e.create("td",{align:this._isRightToLeft?"left":"right",
width:35},d)):(k=e.create("td",{width:35,align:"center"},d),f=e.create("td",{},d));var r=d=30;"simplemarkersymbol"==b.type?(d=Math.min(Math.max(d,b.size+12),125),r=Math.min(Math.max(r,b.size+12),125)):"picturemarkersymbol"==b.type&&(d=Math.min(Math.max(d,b.width),125),r=Math.min(b.height||r,125));k=e.create("div",{style:"width:"+d+"px;height:"+r+"px;"},k);D.isDefined(g)&&"number"===typeof g&&(g=""+g);e.create("td",{innerHTML:g||"",align:this._align},e.create("tr",{},e.create("tbody",{},e.create("table",
{width:"95%"},f))));a=this._drawSymbol(k,b,c,d,r,h,a,m);this._surfaceItems.push(a)},_addSubHeader:function(a,b){var c=e.create("tr",{},a),c=e.create("td",{align:this._align,colspan:2},c);e.create("td",{innerHTML:b||"",align:this._align},e.create("tr",{},e.create("tbody",{},e.create("table",{width:"95%"},c))))},_drawSymbol:function(a,b,c,g,h,e,f,d){b=C.fromJson(b.toJson());var k=f.opacity;c&&b.setColor(new z(c.toRgba()));if("simplelinesymbol"===b.type||"cartographiclinesymbol"===b.type||"textsymbol"===
b.type){if(!b.color)return;c=b.color.toRgba();c[3]*=k;b.color.setColor(c)}else if("simplemarkersymbol"===b.type||"simplefillsymbol"===b.type){if(!b.color)return;c=b.color.toRgba();c[3]*=k;b.color.setColor(c);b.outline&&b.outline.color&&(c=b.outline.color.toRgba(),c[3]*=k,b.outline.color.setColor(c))}else"picturemarkersymbol"===b.type&&(a.style.opacity=k,a.style.filter="alpha(opacity\x3d("+100*k+"))");a=E.createSurface(a,g,h);9>n("ie")&&(c=a.getEventSource(),p.set(c,"position","relative"),p.set(c.parentNode,
"position","relative"));e=this._getDrawingToolShape(b,e)||C.getShapeDescriptors(b);var m;try{m=a.createShape(d||e.defaultShape).setFill(e.fill).setStroke(e.stroke)}catch(r){a.clear();a.destroy();return}var t=m.getBoundingBox();d=t.width;e=t.height;var k=-(t.x+d/2),l=-(t.y+e/2);c=a.getDimensions();k={dx:k+c.width/2,dy:l+c.height/2};if("simplemarkersymbol"===b.type&&"path"===b.style)g=f._getScaleMatrix(t,b.size),m.applyTransform(K.scaleAt(g.xx,g.yy,{x:c.width/2,y:c.height/2}));else if(d>g||e>h)f=d/
g>e/h,g=((f?g:h)-5)/(f?d:e),u.mixin(k,{xx:g,yy:g});m.applyTransform(k);return a},_getDrawingToolShape:function(a,b){var c;switch(b?b.drawingTool||null:null){case "esriFeatureEditToolArrow":c={type:"path",path:"M 10,1 L 3,8 L 3,5 L -15,5 L -15,-2 L 3,-2 L 3,-5 L 10,1 E"};break;case "esriFeatureEditToolTriangle":c={type:"path",path:"M -10,14 L 2,-10 L 14,14 L -10,14 E"};break;case "esriFeatureEditToolRectangle":c={type:"path",path:"M -10,-10 L 10,-10 L 10,10 L -10,10 L -10,-10 E"};break;case "esriFeatureEditToolCircle":c=
{type:"circle",cx:0,cy:0,r:10};break;case "esriFeatureEditToolEllipse":c={type:"ellipse",cx:0,cy:0,rx:10,ry:5};break;default:return null}return{defaultShape:c,fill:a.getFill(),stroke:a.getStroke()}},_repaintItems:function(){l.forEach(this._surfaceItems,function(a){this._repaint(a)},this)},_repaint:function(a){if(a){a.getStroke&&a.setStroke&&a.setStroke(a.getStroke());try{a.getFill&&a.setFill&&a.setFill(a.getFill())}catch(b){}a.children&&u.isArray(a.children)&&l.forEach(a.children,this._repaint,this)}},
_createHoverAction:function(a,b,c){var g=b._hoverLabel||b._hoverLabels[c.id];g&&(b.mouseMoveHandler=b.mouseMoveHandler||{},b.mouseMoveHandler[c.id]=d.connect(a,"onmousemove",u.hitch(this,function(a,b){this.mouseX=b.clientX;this.mouseY=b.clientY;this.hoverLabelShowing&&(this.hoverLabelShowing=!1,p.set(m.byId(this.id+"_hoverLabel"),"display","none"));setTimeout(u.hitch(this,function(a,b,c){if(a==this.mouseX&&b==this.mouseY&&!this.hoverLabelShowing)if(this.hoverLabelShowing=!0,m.byId(this.id+"_hoverLabel")){var g=
m.byId(this.id+"_hoverLabel");g.innerHTML="\x3cspan\x3e"+c+"\x3c/span\x3e";p.set(g,"top",b+"px");p.set(g,"left",a+15+"px");p.set(g,"display","")}else e.create("div",{innerHTML:"\x3cspan\x3e"+c+"\x3c/span\x3e",id:this.id+"_hoverLabel","class":"esriLegendHoverLabel",style:{top:b+"px",left:a+15+"px"}},document.body)},b.clientX,b.clientY,a),500)},g)),b.mouseOutHandler=b.mouseOutHandler||{},b.mouseOutHandler[c.id]=d.connect(a,"onmouseout",u.hitch(this,function(a){this.mouseY=this.mouseX=-1;this.hoverLabelShowing&&
(this.hoverLabelShowing=!1,p.set(m.byId(this.id+"_hoverLabel"),"display","none"))})))},_removeHoverHandlers:function(){var a;l.forEach(this.layers,function(b){if(b.mouseMoveHandler)for(a in b.mouseMoveHandler)d.disconnect(b.mouseMoveHandler[a]);if(b.mouseOutHandler)for(a in b.mouseOutHandler)d.disconnect(b.mouseOutHandler[a])})},_createDynamicLayers:function(a){var b=[],c;l.forEach(a.dynamicLayerInfos||a.layerInfos,function(g){c={id:g.id};c.source=g.source&&g.source.toJson();var e;a.layerDefinitions&&
a.layerDefinitions[g.id]&&(e=a.layerDefinitions[g.id]);e&&(c.definitionExpression=e);var h;a.layerDrawingOptions&&a.layerDrawingOptions[g.id]&&(h=a.layerDrawingOptions[g.id]);h&&(c.drawingInfo=h.toJson());c.minScale=g.minScale||0;c.maxScale=g.maxScale||0;b.push(c)});return b},_getTemplateFromTypes:function(a,b){var c;for(c=0;c<a.length;c++)if(a[c].id==b&&a[c].templates&&0<a[c].templates.length)return a[c].templates[0];return null},_findParentGroup:function(a,b,c){var g,e=b.dynamicLayerInfos||b.layerInfos;
for(g=0;g<e.length;g++)if(c==e[g].id){-1<e[g].parentLayerId&&(p.set(m.byId(this.id+"_"+a+"_"+e[g].parentLayerId+"_group"),"display","block"),this._findParentGroup(a,b,e[g].parentLayerId));break}},_addSubLayersToHide:function(a){function b(c,g){var e=a.layer.dynamicLayerInfos||a.layer.layerInfos,h,f;for(h=0;h<e.length;h++)if(e[h].id===c&&e[h].subLayerIds)for(f=0;f<e[h].subLayerIds.length;f++){var d=e[h].subLayerIds[f];-1===l.indexOf(g,d)&&(g.push(d),b(d,g))}}a.layer.layerInfos&&l.forEach(a.layer._hideLayersInLegend,
function(c){b(c,a.layer._hideLayersInLegend)})},_isLayerInScale:function(a,b,c){var e,h=!0;if(a.legendResponse&&a.legendResponse.layers)for(e=0;e<a.legendResponse.layers.length;e++){var f=a.legendResponse.layers[e];if(b.id==f.layerId){var d,m;!a.minScale&&0!==a.minScale||!a.maxScale&&0!==a.maxScale?(0==f.minScale&&a.tileInfo&&(d=a.tileInfo.lods[0].scale),0==f.maxScale&&a.tileInfo&&(m=a.tileInfo.lods[a.tileInfo.lods.length-1].scale)):(d=Math.min(a.minScale,f.minScale)||a.minScale||f.minScale,m=Math.max(a.maxScale,
f.maxScale));if(0<d&&d<c||m>c)h=!1;break}}else if(a.minScale||a.maxScale)if(a.minScale&&a.minScale<c||a.maxScale&&a.maxScale>c)h=!1;return h},_getServiceTitle:function(a){var b=a._titleForLegend;b||((b=a.url)?-1<a.url.indexOf("/MapServer")?(b=a.url.substring(0,a.url.indexOf("/MapServer")),b=b.substring(b.lastIndexOf("/")+1,b.length)):-1<a.url.indexOf("/ImageServer")?(b=a.url.substring(0,a.url.indexOf("/ImageServer")),b=b.substring(b.lastIndexOf("/")+1,b.length)):-1<a.url.indexOf("/FeatureServer")&&
(b=a.url.substring(0,a.url.indexOf("/FeatureServer")),b=b.substring(b.lastIndexOf("/")+1,b.length)):b="",a.name&&(b=0<b.length?b+(" - "+a.name):a.name));return L.encode(b)},_getEffectiveScale:function(a,b){var c=b.minScale,e=b.maxScale;if(D.isDefined(b.parentLayerId)){var h=a.layerInfos,f=b.parentLayerId,d;for(d=h.length-1;0<=d;d--)if(h[d].id==f)if(0==c&&0<h[d].minScale?c=h[d].minScale:0<c&&0==h[d].minScale||0<c&&0<h[d].minScale&&(c=Math.min(c,h[d].minScale)),e=Math.max(e||0,h[d].maxScale||0),-1<
h[d].parentLayerId)f=h[d].parentLayerId;else break}return{minScale:c,maxScale:e}},_isSupportedLayerType:function(a){return a&&("esri.layers.ArcGISDynamicMapServiceLayer"===a.declaredClass||"esri.layers.ArcGISImageServiceLayer"===a.declaredClass&&10.2<=a.version||"esri.layers.ArcGISTiledMapServiceLayer"===a.declaredClass||"esri.layers.FeatureLayer"===a.declaredClass||"esri.layers.StreamLayer"===a.declaredClass||"esri.layers.KMLLayer"===a.declaredClass||"esri.layers.GeoRSSLayer"===a.declaredClass||
"esri.layers.WMSLayer"===a.declaredClass||"esri.layers.CSVLayer"===a.declaredClass)?!0:!1}});u.mixin(A,{ALIGN_LEFT:0,ALIGN_RIGHT:1});return A})},"dojox/html/entities":function(){define(["dojo/_base/lang"],function(y){var x=y.getObject("dojox.html.entities",!0),u=function(d,f){var l,n;if(f._encCache&&f._encCache.regexp&&f._encCache.mapper&&f.length==f._encCache.length)l=f._encCache.mapper,n=f._encCache.regexp;else{l={};n=["["];var s;for(s=0;s<f.length;s++)l[f[s][0]]="\x26"+f[s][1]+";",n.push(f[s][0]);
n.push("]");n=RegExp(n.join(""),"g");f._encCache={mapper:l,regexp:n,length:f.length}}return d=d.replace(n,function(h){return l[h]})},l=function(d,f){var l,n;if(f._decCache&&f._decCache.regexp&&f._decCache.mapper&&f.length==f._decCache.length)l=f._decCache.mapper,n=f._decCache.regexp;else{l={};n=["("];var s;for(s=0;s<f.length;s++){var h="\x26"+f[s][1]+";";s&&n.push("|");l[h]=f[s][0];n.push(h)}n.push(")");n=RegExp(n.join(""),"g");f._decCache={mapper:l,regexp:n,length:f.length}}return d=d.replace(n,
function(h){return l[h]})};x.html=[["\x26","amp"],['"',"quot"],["\x3c","lt"],["\x3e","gt"],["\u00a0","nbsp"]];x.latin=[["\u00a1","iexcl"],["\u00a2","cent"],["\u00a3","pound"],["\u20ac","euro"],["\u00a4","curren"],["\u00a5","yen"],["\u00a6","brvbar"],["\u00a7","sect"],["\u00a8","uml"],["\u00a9","copy"],["\u00aa","ordf"],["\u00ab","laquo"],["\u00ac","not"],["\u00ad","shy"],["\u00ae","reg"],["\u00af","macr"],["\u00b0","deg"],["\u00b1","plusmn"],["\u00b2","sup2"],["\u00b3","sup3"],["\u00b4","acute"],
["\u00b5","micro"],["\u00b6","para"],["\u00b7","middot"],["\u00b8","cedil"],["\u00b9","sup1"],["\u00ba","ordm"],["\u00bb","raquo"],["\u00bc","frac14"],["\u00bd","frac12"],["\u00be","frac34"],["\u00bf","iquest"],["\u00c0","Agrave"],["\u00c1","Aacute"],["\u00c2","Acirc"],["\u00c3","Atilde"],["\u00c4","Auml"],["\u00c5","Aring"],["\u00c6","AElig"],["\u00c7","Ccedil"],["\u00c8","Egrave"],["\u00c9","Eacute"],["\u00ca","Ecirc"],["\u00cb","Euml"],["\u00cc","Igrave"],["\u00cd","Iacute"],["\u00ce","Icirc"],
["\u00cf","Iuml"],["\u00d0","ETH"],["\u00d1","Ntilde"],["\u00d2","Ograve"],["\u00d3","Oacute"],["\u00d4","Ocirc"],["\u00d5","Otilde"],["\u00d6","Ouml"],["\u00d7","times"],["\u00d8","Oslash"],["\u00d9","Ugrave"],["\u00da","Uacute"],["\u00db","Ucirc"],["\u00dc","Uuml"],["\u00dd","Yacute"],["\u00de","THORN"],["\u00df","szlig"],["\u00e0","agrave"],["\u00e1","aacute"],["\u00e2","acirc"],["\u00e3","atilde"],["\u00e4","auml"],["\u00e5","aring"],["\u00e6","aelig"],["\u00e7","ccedil"],["\u00e8","egrave"],
["\u00e9","eacute"],["\u00ea","ecirc"],["\u00eb","euml"],["\u00ec","igrave"],["\u00ed","iacute"],["\u00ee","icirc"],["\u00ef","iuml"],["\u00f0","eth"],["\u00f1","ntilde"],["\u00f2","ograve"],["\u00f3","oacute"],["\u00f4","ocirc"],["\u00f5","otilde"],["\u00f6","ouml"],["\u00f7","divide"],["\u00f8","oslash"],["\u00f9","ugrave"],["\u00fa","uacute"],["\u00fb","ucirc"],["\u00fc","uuml"],["\u00fd","yacute"],["\u00fe","thorn"],["\u00ff","yuml"],["\u0192","fnof"],["\u0391","Alpha"],["\u0392","Beta"],["\u0393",
"Gamma"],["\u0394","Delta"],["\u0395","Epsilon"],["\u0396","Zeta"],["\u0397","Eta"],["\u0398","Theta"],["\u0399","Iota"],["\u039a","Kappa"],["\u039b","Lambda"],["\u039c","Mu"],["\u039d","Nu"],["\u039e","Xi"],["\u039f","Omicron"],["\u03a0","Pi"],["\u03a1","Rho"],["\u03a3","Sigma"],["\u03a4","Tau"],["\u03a5","Upsilon"],["\u03a6","Phi"],["\u03a7","Chi"],["\u03a8","Psi"],["\u03a9","Omega"],["\u03b1","alpha"],["\u03b2","beta"],["\u03b3","gamma"],["\u03b4","delta"],["\u03b5","epsilon"],["\u03b6","zeta"],
["\u03b7","eta"],["\u03b8","theta"],["\u03b9","iota"],["\u03ba","kappa"],["\u03bb","lambda"],["\u03bc","mu"],["\u03bd","nu"],["\u03be","xi"],["\u03bf","omicron"],["\u03c0","pi"],["\u03c1","rho"],["\u03c2","sigmaf"],["\u03c3","sigma"],["\u03c4","tau"],["\u03c5","upsilon"],["\u03c6","phi"],["\u03c7","chi"],["\u03c8","psi"],["\u03c9","omega"],["\u03d1","thetasym"],["\u03d2","upsih"],["\u03d6","piv"],["\u2022","bull"],["\u2026","hellip"],["\u2032","prime"],["\u2033","Prime"],["\u203e","oline"],["\u2044",
"frasl"],["\u2118","weierp"],["\u2111","image"],["\u211c","real"],["\u2122","trade"],["\u2135","alefsym"],["\u2190","larr"],["\u2191","uarr"],["\u2192","rarr"],["\u2193","darr"],["\u2194","harr"],["\u21b5","crarr"],["\u21d0","lArr"],["\u21d1","uArr"],["\u21d2","rArr"],["\u21d3","dArr"],["\u21d4","hArr"],["\u2200","forall"],["\u2202","part"],["\u2203","exist"],["\u2205","empty"],["\u2207","nabla"],["\u2208","isin"],["\u2209","notin"],["\u220b","ni"],["\u220f","prod"],["\u2211","sum"],["\u2212","minus"],
["\u2217","lowast"],["\u221a","radic"],["\u221d","prop"],["\u221e","infin"],["\u2220","ang"],["\u2227","and"],["\u2228","or"],["\u2229","cap"],["\u222a","cup"],["\u222b","int"],["\u2234","there4"],["\u223c","sim"],["\u2245","cong"],["\u2248","asymp"],["\u2260","ne"],["\u2261","equiv"],["\u2264","le"],["\u2265","ge"],["\u2282","sub"],["\u2283","sup"],["\u2284","nsub"],["\u2286","sube"],["\u2287","supe"],["\u2295","oplus"],["\u2297","otimes"],["\u22a5","perp"],["\u22c5","sdot"],["\u2308","lceil"],["\u2309",
"rceil"],["\u230a","lfloor"],["\u230b","rfloor"],["\u2329","lang"],["\u232a","rang"],["\u25ca","loz"],["\u2660","spades"],["\u2663","clubs"],["\u2665","hearts"],["\u2666","diams"],["\u0152","OElig"],["\u0153","oelig"],["\u0160","Scaron"],["\u0161","scaron"],["\u0178","Yuml"],["\u02c6","circ"],["\u02dc","tilde"],["\u2002","ensp"],["\u2003","emsp"],["\u2009","thinsp"],["\u200c","zwnj"],["\u200d","zwj"],["\u200e","lrm"],["\u200f","rlm"],["\u2013","ndash"],["\u2014","mdash"],["\u2018","lsquo"],["\u2019",
"rsquo"],["\u201a","sbquo"],["\u201c","ldquo"],["\u201d","rdquo"],["\u201e","bdquo"],["\u2020","dagger"],["\u2021","Dagger"],["\u2030","permil"],["\u2039","lsaquo"],["\u203a","rsaquo"]];x.encode=function(d,f){d&&(f?d=u(d,f):(d=u(d,x.html),d=u(d,x.latin)));return d};x.decode=function(d,f){d&&(f?d=l(d,f):(d=l(d,x.html),d=l(d,x.latin)));return d};return x})},"esri/renderers/ScaleDependentRenderer":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","./Renderer"],function(y,
x,u,l,d){return y(d,{declaredClass:"esri.renderer.ScaleDependentRenderer",constructor:function(f){this.setRendererInfos(f&&f.rendererInfos||[])},setRendererInfos:function(f){this.rendererInfos=f;this._setRangeType();return this},getSymbol:function(f){var d=this.getRendererInfo(f);return d&&d.renderer.getSymbol(f)},getRendererInfo:function(f){f=f.getLayer().getMap();return"zoom"===this.rangeType?this.getRendererInfoByZoom(f.getZoom()):this.getRendererInfoByScale(f.getScale())},getRendererInfoByZoom:function(f){var d,
l=this.rendererInfos,s,h=0;do d=l[h],f>=d.minZoom&&f<=d.maxZoom&&(s=d),h++;while(!s&&h<l.length);return s},getRendererInfoByScale:function(d){var l,n=this.rendererInfos,s,h=0,r,t,m,e;do l=n[h],r=l.minScale,t=l.maxScale,m=!r,e=!t,!m&&d<=r&&(m=!0),!e&&d>=t&&(e=!0),m&&e&&(s=l),h++;while(!s&&h<n.length);return s},addRendererInfo:function(d){var l,n=0,s,h=this.rendererInfos,r=d.hasOwnProperty("minZoom")?"minZoom":"minScale",t=h.length;do{s=h[n];if(t===n||d[r]<s[r])h.splice(n,0,d),this._setRangeType(),
l=!0;n++}while(!l&&n<t);return this},_setRangeType:function(){var d=this.rendererInfos;if(d=d&&d[0])this.rangeType=d.hasOwnProperty("minZoom")?"zoom":d.hasOwnProperty("minScale")?"scale":""},toJson:function(){}})})},"esri/renderers/DotDensityRenderer":function(){define("dojo/_base/declare dojo/_base/lang dojo/dom-construct dojo/has ../kernel ./Renderer ../symbols/PictureFillSymbol ../geometry/ScreenPoint ../geometry/Point".split(" "),function(y,x,u,l,d,f,z,n,s){return y(f,{declaredClass:"esri.renderer.DotDensityRenderer",
constructor:function(h){this.dotSize=h.dotSize||3;this.dotValue=h.dotValue;this.fields=h.fields;this.outline=h.outline;this.backgroundColor=h.backgroundColor;this.exactCount=h.exactCount||!0;this.dotShape=h.dotShape||"square";this.legendOptions=h.legendOptions;this._exactCountMinArea=1E4;this._currentMapScale=this._map=this._canvas=null;this._symbolMap={};this._currentGraphic=this._currentResolution=this._objectIdField=null;this._supportsCanvas=window.CanvasRenderingContext2D?!0:!1;window.CanvasRenderingContext2D||
console.log("The DotDensityRenderer requires a Canvas enabled Browser.  IE8 and less does not support Canvas.")},getSymbol:function(h){var d,f;this._currentGraphic=h;if(!this._supportsCanvas)return null;this._map||(this._map=h.getLayer()._map,this._objectIdField=h.getLayer().objectIdField,this._currentMapScale=this._map.getScale(),this._currentResolution=this._map.extent.getWidth()/this._map.width,this._map.on("zoom-end",x.hitch(this,function(h){this._currentMapScale=this._map.getScale();this._currentResolution=
h.extent.getWidth()/this._map.width;this._symbolMap[this._currentMapScale]={}})));if(this._symbolMap[this._currentMapScale]&&this._symbolMap[this._currentMapScale][h.attributes[this._objectIdField]])return d=this._symbolMap[this._currentMapScale][h.attributes[this._objectIdField]],f=this._getShapeProperties(h),d.setOffset(f.dx,f.dy),d;d=this._generateFieldsCount(this.fields,h.attributes,this.dotValue);f=this._getShapeProperties(h);d=new z(this._generateImageSrc(f.width,f.height,d,f.minXY,f.maxXY),
this.outline,f.width,f.height);d.setOffset(f.dx,f.dy);this._symbolMap[this._currentMapScale]||(this._symbolMap[this._currentMapScale]={});return this._symbolMap[this._currentMapScale][h.attributes[this._objectIdField]]=d},_generateFieldsCount:function(h,d,f){var m,e;for(e=h.length-1;0<=e;e--)m=d[h[e].name]/f,h[e].numPoints=Math.round(m);return h},_getShapeProperties:function(h){var d,f,m,e;d=h.geometry.getExtent();d.contains(this._map.extent)&&(d=this._map.extent);m=Math.ceil(d.getWidth()/this._currentResolution);
e=Math.ceil(d.getHeight()/this._currentResolution);f=this._map.toScreen(new s(d.xmin,d.ymin,d.spatialReference));d=this._map.toScreen(new s(d.xmax,d.ymax,d.spatialReference));h=h.getLayer().getNode().getCTM();return{minXY:f,maxXY:d,dx:(f.x-h.e)%m,dy:(d.y-h.f)%e,width:m,height:e}},_generateImageSrc:function(d,f,l,m,e,p){var n=this.dotSize,s,u,x;this._canvas?(this._canvas.width=d,this._canvas.height=f):this._canvas=this._initCanvas(d,f);s=this._canvas.getContext("2d");if(p=p||this.backgroundColor)s.fillStyle=
p.toCss(!0),s.fillRect(0,0,d,f),s.fill();for(p=l.length-1;0<=p;p--){s.fillStyle=l[p].color.toCss(!0);for(u=l[p].numPoints-1;0<=u;u--)x=this._getRandomPoint(d,f,m,e),"square"===this.dotShape?s.fillRect(x.x,x.y,n,n):"circle"===this.dotShape&&(s.beginPath(),s.arc(x.x,x.y,n/2,0,2*Math.PI,!0)),s.fill()}return this._canvas.toDataURL()},_initCanvas:function(d,f){var l=u.create("canvas",{id:"canvas",width:d+"px",height:f+"px",style:"position: absolute; left: -10000px; top: 0px;"},null);document.body.appendChild(l);
return l},_getRandomInt:function(d,f){return Math.floor(Math.random()*(f-d+1)+d)},_getRandomPoint:function(d,f,l,m){var e={},p=this.outline&&this.outline.width?this.outline.width:0;if(!0===this.exactCount&&d*f>this._exactCountMinArea){do e.x=this._getRandomInt(l.x,m.x),e.y=this._getRandomInt(m.y,l.y),d=new n(e.x,e.y),d=this._checkPointShapeBounds(d,this.dotSize+p,this._currentGraphic.geometry),!0===d&&(e.x-=l.x,e.y-=m.y);while(!1===d)}else e.x=this._getRandomInt(0,d),e.y=this._getRandomInt(0,f);return e},
_checkPointShapeBounds:function(d,f,l){var m=null,m=!1,e=!0,p=0;do{switch(p){case 1:d.x+=f;break;case 2:d.y+=f;break;case 3:d.x-=f}m=this._map.toMap(d);m=l.contains(m);!1===m&&(e=!1);p+=1}while(3>=p&&!0===e);return m},setDotSize:function(d){0<d&&(this.dotSize=d)},setDotValue:function(d){0<d&&(this.dotValue=d)},setOutline:function(d){this.outline=d},setBackgroundColor:function(d){this.backgroundColor=d},toJson:function(){}})})},"widgets/Legend/_build-generate_module":function(){define(["dojo/text!./Widget.html",
"dojo/text!./css/style.css","dojo/i18n!./nls/strings","dojo/text!./config.json"],function(){})},"url:widgets/Legend/Widget.html":'\x3cdiv\x3e\n  \x3cdiv data-dojo-attach-point\x3d"legendDiv"\x3e\x3c/div\x3e\n  \x3cdiv style\x3d"display:none" data-dojo-attach-point\x3d"removedDiv"\x3e\x3c/div\x3e\n\x3c/div\x3e\n\n\n',"url:widgets/Legend/css/style.css":".esriLegendServiceLabel {font-size: 14px;}.esriLegendLayer{font-size: 12px;}","url:widgets/Legend/config.json":'{\n  "legend":{\n    "arrangement": 0,\n    "autoUpdate": true,\n    "respectCurrentMapScale": true\n  }\n}',
"*now":function(y){y(['dojo/i18n!*preload*widgets/Legend/nls/Widget*["ar","cs","da","de","en","es","et","fi","fr","he","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sv","th","tr","zh-cn","ROOT"]'])}}});
define("dojo/_base/declare dojo/_base/array dojo/_base/html dojo/_base/lang dojo/dom dojo/on dojo/aspect dijit/_WidgetsInTemplateMixin jimu/BaseWidget jimu/LayerInfos/LayerInfos jimu/dijit/Message esri/dijit/Legend".split(" "),function(y,x,u,l,d,f,z,n,s,h,r,t){return y([s,n],{name:"Legend",baseClass:"jimu-widget-legend",layerInfos:[],legend:null,startup:function(){this.inherited(arguments);h.getInstance(this.map,this.map.itemInfo).then(l.hitch(this,function(d){this.config.legend.map=this.map;this.legend=
new t(this.config.legend,this.legendDiv);this.legend.startup();this.removeLegendOfBasemap();this.legend&&this.legend._createLegend&&z.after(this.legend,"_createLegend",l.hitch(this,"removeLegendOfBasemap"));this.own(f(d,"layerInfosIsShowInMapChanged",l.hitch(this,"onLayersVisibilityChange")))}),l.hitch(this,function(d){console.error(d);new r({message:d.message||d})}))},onLayersVisibilityChange:function(){this.legend.refresh()},_getInvalidLegendLayer:function(){var d=[],e=this.map.getBasemap();this.map.itemInfo&&
this.map.itemInfo.itemData?(x.forEach(this.map.itemInfo.itemData.baseMap.baseMapLayers,function(e){d.push(e.id)}),x.forEach(this.map.itemInfo.itemData.operationalLayers,function(e){!1===e.showLegend&&d.push(e.id)}),x.forEach(this.map.layerIds,l.hitch(this,function(e){this.map.getLayer(e)._basemapGalleryLayerType&&d.push(e)}))):x.forEach(this.map.layerIds,l.hitch(this,function(e){this.map.getLayer(e).isOperationalLayer||d.push(e)}));e&&d.push(e);return d},removeLegendOfBasemap:function(){x.forEach(this._getInvalidLegendLayer(),
function(f){console.log(f);(f=d.byId(this.legend.id+"_"+f))&&1===f.nodeType&&this.removedDiv.appendChild(f)},this)}})});