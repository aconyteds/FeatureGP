//>>built
define("dojo/_base/lang dojo/Deferred dojo/_base/array dojo/promise/all jimu/portalUtils jimu/SpatialReference/wkidUtils esri/request".split(" "),function(f,h,k,p,m,q,r){function l(a){if(null===a)return a;var b=a.indexOf("?");return 0===a.indexOf("http")&&-1!==b?a.slice(0,b):a}function n(a){var b=[];k.forEach(a,function(a){b.push(a.url)});b.sort();a="";for(var c=0,c=0;c<b.length;c++){var d=b[c].indexOf("?"),e="",e=-1!==d?b[c].slice(0,d):b[c];a+=e}return a.replace(/\ /,"")}function s(a){var b=!1;if(a)for(var c=
0;c<a.length;c++)if(a[c].type){b=!0;break}return b}function t(a,b){var c=null,d=new h;b.spatialReference||a.spatialReference?(c=b.spatialReference||a.spatialReference,d.resolve(c)):a.owner&&0===a.owner.indexOf("esri_")?d.resolve({wkid:"102100"}):s(b.baseMap.baseMapLayers)?d.resolve({wkid:"102100"}):b.baseMap.baseMapLayers&&b.baseMap.baseMapLayers[0]?r({url:b.baseMap.baseMapLayers[0].url,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}).then(f.hitch(this,function(a){c=a.spatialReference?
a.spatialReference:null;d.resolve(c)}),f.hitch(this,function(){d.resolve(null)})):d.resolve(null);return d}return{_loadPortalBaseMaps:function(a,b){var c=new h,d=[];m.getWebMapsFromBasemapGalleryGroup(a).then(function(a){k.forEach(a.results,function(a){var c=new h;d.push(c);a.getItemData().then(function(d){t(a,d).then(f.hitch(this,function(e){var f=[];if(b&&e&&q.isSameSR(b.wkid,e.wkid)){var f=k.map(d.baseMap.baseMapLayers,function(a){return a}),g=null;a.thumbnailUrl&&(g=a.thumbnailUrl.indexOf("?"),
g=-1!==g?a.thumbnailUrl.slice(0,g):a.thumbnailUrl);c.resolve({layers:f,title:a.title,thumbnailUrl:g,spatialReference:e})}else c.resolve({})}))})});p(d).then(function(a){c.resolve(a)})},function(a){c.reject(a)});return c},compareSameBasemap:function(a,b){var c=b.layers,d="",e="",d=n(a.layers),e=n(c);return d===e},compareSameBasemapByOrder:function(a,b){var c=a.layers,d=b.layers;if(c.length!==d.length)return!1;for(var e=0;e<c.length;e++)if(c[e].type||(c[e].type=null),d[e].type||(d[e].type=null),c[e].type!==
d[e].type||!c[e].type&&!c[e].type&&(c[e].url||(c[e].url=null),d[e].url||(d[e].url=null),l(c[e].url)!==l(d[e].url)))return!1;return!0},isBingMap:function(a){if(!a||!a.layers)return!1;for(var b=0;b<a.layers.length;b++)if("BingMapsAerial"===a.layers[b].type||"BingMapsRoad"===a.layers[b].type||"BingMapsHybrid"===a.layers[b].type)return!0;return!1},isNoUrlLayerMap:function(a){if(!a||!a.layers)return!1;for(var b=0;b<a.layers.length;b++)if("BingMapsAerial"===a.layers[b].type||"BingMapsRoad"===a.layers[b].type||
"BingMapsHybrid"===a.layers[b].type||"OpenStreetMap"===a.layers[b].type)return!0;return!1},getToken:function(a){a=m.getPortal(a);a.updateCredential();return a.credential?"?token\x3d"+a.credential.token:""},removeUrlQuery:function(a){return l(a)}}});